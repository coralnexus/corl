<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class CORL::Plugin::Node - corl 0.5.7</title>

<link type="text/css" media="screen" href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../../index.html">Home</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/core/plugin/node.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">Nucleon.plugin_class(:nucleon, :base)
  
</nav>

    <!-- Included Modules -->
<nav id="includes-section" class="section">
  <h3 class="section-header">Included Modules</h3>

  <ul class="link-list">
  
  
    <li><span class="include">Parallel</span>
  
  
  </ul>
</nav>

    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-build_info">::build_info</a>
    
    <li><a href="#method-c-translate">::translate</a>
    
    <li><a href="#method-c-translate_reference">::translate_reference</a>
    
    <li><a href="#method-i-action">#action</a>
    
    <li><a href="#method-i-add_agent">#add_agent</a>
    
    <li><a href="#method-i-agent">#agent</a>
    
    <li><a href="#method-i-agents">#agents</a>
    
    <li><a href="#method-i-attach_keys">#attach_keys</a>
    
    <li><a href="#method-i-bootstrap">#bootstrap</a>
    
    <li><a href="#method-i-bootstrap_script">#bootstrap_script</a>
    
    <li><a href="#method-i-bootstrap_script-3D">#bootstrap_script=</a>
    
    <li><a href="#method-i-build">#build</a>
    
    <li><a href="#method-i-build_provider">#build_provider</a>
    
    <li><a href="#method-i-build_provisioner">#build_provisioner</a>
    
    <li><a href="#method-i-build_provisioners">#build_provisioners</a>
    
    <li><a href="#method-i-build_time">#build_time</a>
    
    <li><a href="#method-i-build_time-3D">#build_time=</a>
    
    <li><a href="#method-i-clear_remote_cache">#clear_remote_cache</a>
    
    <li><a href="#method-i-cli">#cli</a>
    
    <li><a href="#method-i-cli_capture">#cli_capture</a>
    
    <li><a href="#method-i-cli_check">#cli_check</a>
    
    <li><a href="#method-i-command">#command</a>
    
    <li><a href="#method-i-create">#create</a>
    
    <li><a href="#method-i-create_facts_post">#create_facts_post</a>
    
    <li><a href="#method-i-create_image">#create_image</a>
    
    <li><a href="#method-i-create_machine">#create_machine</a>
    
    <li><a href="#method-i-custom_facts">#custom_facts</a>
    
    <li><a href="#method-i-custom_facts-3D">#custom_facts=</a>
    
    <li><a href="#method-i-delete_facts_post">#delete_facts_post</a>
    
    <li><a href="#method-i-delete_keys">#delete_keys</a>
    
    <li><a href="#method-i-delete_remote_cache_setting">#delete_remote_cache_setting</a>
    
    <li><a href="#method-i-destroy">#destroy</a>
    
    <li><a href="#method-i-download">#download</a>
    
    <li><a href="#method-i-ensure_custom_facts">#ensure_custom_facts</a>
    
    <li><a href="#method-i-exec">#exec</a>
    
    <li><a href="#method-i-fact_var">#fact_var</a>
    
    <li><a href="#method-i-fact_var-3D">#fact_var=</a>
    
    <li><a href="#method-i-facts">#facts</a>
    
    <li><a href="#method-i-filter_output">#filter_output</a>
    
    <li><a href="#method-i-hiera_override_dir">#hiera_override_dir</a>
    
    <li><a href="#method-i-hiera_var">#hiera_var</a>
    
    <li><a href="#method-i-hiera_var-3D">#hiera_var=</a>
    
    <li><a href="#method-i-home">#home</a>
    
    <li><a href="#method-i-hostname">#hostname</a>
    
    <li><a href="#method-i-id">#id</a>
    
    <li><a href="#method-i-image">#image</a>
    
    <li><a href="#method-i-image-3D">#image=</a>
    
    <li><a href="#method-i-image_id">#image_id</a>
    
    <li><a href="#method-i-image_search_text">#image_search_text</a>
    
    <li><a href="#method-i-images">#images</a>
    
    <li><a href="#method-i-keypair">#keypair</a>
    
    <li><a href="#method-i-keypair-3D">#keypair=</a>
    
    <li><a href="#method-i-local-3F">#local?</a>
    
    <li><a href="#method-i-local_machine">#local_machine</a>
    
    <li><a href="#method-i-local_machine-3D">#local_machine=</a>
    
    <li><a href="#method-i-localize">#localize</a>
    
    <li><a href="#method-i-lookup">#lookup</a>
    
    <li><a href="#method-i-machine">#machine</a>
    
    <li><a href="#method-i-machine-3D">#machine=</a>
    
    <li><a href="#method-i-machine_config">#machine_config</a>
    
    <li><a href="#method-i-machine_type">#machine_type</a>
    
    <li><a href="#method-i-machine_type_id">#machine_type_id</a>
    
    <li><a href="#method-i-machine_types">#machine_types</a>
    
    <li><a href="#method-i-method_missing">#method_missing</a>
    
    <li><a href="#method-i-normalize">#normalize</a>
    
    <li><a href="#method-i-private_ip">#private_ip</a>
    
    <li><a href="#method-i-private_key">#private_key</a>
    
    <li><a href="#method-i-private_key-3D">#private_key=</a>
    
    <li><a href="#method-i-profiles">#profiles</a>
    
    <li><a href="#method-i-profiles-3D">#profiles=</a>
    
    <li><a href="#method-i-provisioner_info">#provisioner_info</a>
    
    <li><a href="#method-i-provisioners">#provisioners</a>
    
    <li><a href="#method-i-public_ip">#public_ip</a>
    
    <li><a href="#method-i-public_key">#public_key</a>
    
    <li><a href="#method-i-public_key-3D">#public_key=</a>
    
    <li><a href="#method-i-reload">#reload</a>
    
    <li><a href="#method-i-remote_cache_setting">#remote_cache_setting</a>
    
    <li><a href="#method-i-remove_agent">#remove_agent</a>
    
    <li><a href="#method-i-remove_custom_facts">#remove_custom_facts</a>
    
    <li><a href="#method-i-remove_plugin">#remove_plugin</a>
    
    <li><a href="#method-i-render_image">#render_image</a>
    
    <li><a href="#method-i-render_machine_type">#render_machine_type</a>
    
    <li><a href="#method-i-run">#run</a>
    
    <li><a href="#method-i-running-3F">#running?</a>
    
    <li><a href="#method-i-save">#save</a>
    
    <li><a href="#method-i-send_files">#send_files</a>
    
    <li><a href="#method-i-set_remote_cache_setting">#set_remote_cache_setting</a>
    
    <li><a href="#method-i-ssh_path">#ssh_path</a>
    
    <li><a href="#method-i-ssh_port">#ssh_port</a>
    
    <li><a href="#method-i-ssh_port-3D">#ssh_port=</a>
    
    <li><a href="#method-i-start">#start</a>
    
    <li><a href="#method-i-state">#state</a>
    
    <li><a href="#method-i-stop">#stop</a>
    
    <li><a href="#method-i-terminal">#terminal</a>
    
    <li><a href="#method-i-translate_reference">#translate_reference</a>
    
    <li><a href="#method-i-upload">#upload</a>
    
    <li><a href="#method-i-usable_image-3F">#usable_image?</a>
    
    <li><a href="#method-i-user">#user</a>
    
    <li><a href="#method-i-user-3D">#user=</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../../README_rdoc.html">README</a>
  
    <li class="file"><a href="../../info/AUTOMATION_rdoc.html">AUTOMATION</a>
  
    <li class="file"><a href="../../info/INSTALLATION_rdoc.html">INSTALLATION</a>
  
    <li class="file"><a href="../../info/PACKAGING_rdoc.html">PACKAGING</a>
  
    <li class="file"><a href="../../info/PLUGINS_rdoc.html">PLUGINS</a>
  
    <li class="file"><a href="../../info/TODO_rdoc.html">TODO</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../../CORL.html">CORL</a>
  
    <li><a href="../../CORL/Build.html">CORL::Build</a>
  
    <li><a href="../../CORL/Builder.html">CORL::Builder</a>
  
    <li><a href="../../CORL/Builder/Identity.html">CORL::Builder::Identity</a>
  
    <li><a href="../../CORL/Builder/Package.html">CORL::Builder::Package</a>
  
    <li><a href="../../CORL/Builder/Project.html">CORL::Builder::Project</a>
  
    <li><a href="../../CORL/Configuration.html">CORL::Configuration</a>
  
    <li><a href="../../CORL/Configuration/File.html">CORL::Configuration::File</a>
  
    <li><a href="../../CORL/Errors.html">CORL::Errors</a>
  
    <li><a href="../../CORL/Facade.html">CORL::Facade</a>
  
    <li><a href="../../CORL/Machine.html">CORL::Machine</a>
  
    <li><a href="../../CORL/Machine/AWS.html">CORL::Machine::AWS</a>
  
    <li><a href="../../CORL/Machine/Docker.html">CORL::Machine::Docker</a>
  
    <li><a href="../../CORL/Machine/FogBase.html">CORL::Machine::FogBase</a>
  
    <li><a href="../../CORL/Machine/Physical.html">CORL::Machine::Physical</a>
  
    <li><a href="../../CORL/Machine/Rackspace.html">CORL::Machine::Rackspace</a>
  
    <li><a href="../../CORL/Machine/Vagrant.html">CORL::Machine::Vagrant</a>
  
    <li><a href="../../CORL/Mixin.html">CORL::Mixin</a>
  
    <li><a href="../../CORL/Mixin/Action.html">CORL::Mixin::Action</a>
  
    <li><a href="../../CORL/Mixin/Action/Keypair.html">CORL::Mixin::Action::Keypair</a>
  
    <li><a href="../../CORL/Mixin/Action/Registration.html">CORL::Mixin::Action::Registration</a>
  
    <li><a href="../../CORL/Mixin/Builder.html">CORL::Mixin::Builder</a>
  
    <li><a href="../../CORL/Mixin/Builder/Global.html">CORL::Mixin::Builder::Global</a>
  
    <li><a href="../../CORL/Mixin/Builder/Instance.html">CORL::Mixin::Builder::Instance</a>
  
    <li><a href="../../CORL/Mixin/Lookup.html">CORL::Mixin::Lookup</a>
  
    <li><a href="../../CORL/Mixin/Machine.html">CORL::Mixin::Machine</a>
  
    <li><a href="../../CORL/Mixin/Machine/SSH.html">CORL::Mixin::Machine::SSH</a>
  
    <li><a href="../../CORL/Mixin/Macro.html">CORL::Mixin::Macro</a>
  
    <li><a href="../../CORL/Mixin/Macro/NetworkSettings.html">CORL::Mixin::Macro::NetworkSettings</a>
  
    <li><a href="../../CORL/Network.html">CORL::Network</a>
  
    <li><a href="../../CORL/Network/CORL.html">CORL::Network::CORL</a>
  
    <li><a href="../../CORL/Node.html">CORL::Node</a>
  
    <li><a href="../../CORL/Node/AWS.html">CORL::Node::AWS</a>
  
    <li><a href="../../CORL/Node/Docker.html">CORL::Node::Docker</a>
  
    <li><a href="../../CORL/Node/FogBase.html">CORL::Node::FogBase</a>
  
    <li><a href="../../CORL/Node/Local.html">CORL::Node::Local</a>
  
    <li><a href="../../CORL/Node/Rackspace.html">CORL::Node::Rackspace</a>
  
    <li><a href="../../CORL/Node/Vagrant.html">CORL::Node::Vagrant</a>
  
    <li><a href="../../CORL/Plugin.html">CORL::Plugin</a>
  
    <li><a href="../../CORL/Plugin/Builder.html">CORL::Plugin::Builder</a>
  
    <li><a href="../../CORL/Plugin/Configuration.html">CORL::Plugin::Configuration</a>
  
    <li><a href="../../CORL/Plugin/Machine.html">CORL::Plugin::Machine</a>
  
    <li><a href="../../CORL/Plugin/Network.html">CORL::Plugin::Network</a>
  
    <li><a href="../../CORL/Plugin/Node.html">CORL::Plugin::Node</a>
  
    <li><a href="../../CORL/Plugin/Provisioner.html">CORL::Plugin::Provisioner</a>
  
    <li><a href="../../CORL/Provisioner.html">CORL::Provisioner</a>
  
    <li><a href="../../CORL/Provisioner/Puppetnode.html">CORL::Provisioner::Puppetnode</a>
  
    <li><a href="../../CORL/Util.html">CORL::Util</a>
  
    <li><a href="../../CORL/Util/Puppet.html">CORL::Util::Puppet</a>
  
    <li><a href="../../CORL/Util/Puppet/Resource.html">CORL::Util::Puppet::Resource</a>
  
    <li><a href="../../CORL/Util/Puppet/ResourceGroup.html">CORL::Util::Puppet::ResourceGroup</a>
  
    <li><a href="../../CORL/Vagrant.html">CORL::Vagrant</a>
  
    <li><a href="../../CORL/Vagrant/Config.html">CORL::Vagrant::Config</a>
  
    <li><a href="../../Nucleon.html">Nucleon</a>
  
    <li><a href="../../Nucleon/Action.html">Nucleon::Action</a>
  
    <li><a href="../../Nucleon/Action/Cloud.html">Nucleon::Action::Cloud</a>
  
    <li><a href="../../Nucleon/Action/Cloud/Config.html">Nucleon::Action::Cloud::Config</a>
  
    <li><a href="../../Nucleon/Action/Cloud/Create.html">Nucleon::Action::Cloud::Create</a>
  
    <li><a href="../../Nucleon/Action/Cloud/Images.html">Nucleon::Action::Cloud::Images</a>
  
    <li><a href="../../Nucleon/Action/Cloud/Inspect.html">Nucleon::Action::Cloud::Inspect</a>
  
    <li><a href="../../Nucleon/Action/Cloud/Machines.html">Nucleon::Action::Cloud::Machines</a>
  
    <li><a href="../../Nucleon/Action/Cloud/Regions.html">Nucleon::Action::Cloud::Regions</a>
  
    <li><a href="../../Nucleon/Action/Cloud/Remote.html">Nucleon::Action::Cloud::Remote</a>
  
    <li><a href="../../Nucleon/Action/Cloud/Settings.html">Nucleon::Action::Cloud::Settings</a>
  
    <li><a href="../../Nucleon/Action/Cloud/Vagrantfile.html">Nucleon::Action::Cloud::Vagrantfile</a>
  
    <li><a href="../../Nucleon/Action/Node.html">Nucleon::Action::Node</a>
  
    <li><a href="../../Nucleon/Action/Node/Authorize.html">Nucleon::Action::Node::Authorize</a>
  
    <li><a href="../../Nucleon/Action/Node/Bootstrap.html">Nucleon::Action::Node::Bootstrap</a>
  
    <li><a href="../../Nucleon/Action/Node/Build.html">Nucleon::Action::Node::Build</a>
  
    <li><a href="../../Nucleon/Action/Node/Cache.html">Nucleon::Action::Node::Cache</a>
  
    <li><a href="../../Nucleon/Action/Node/Destroy.html">Nucleon::Action::Node::Destroy</a>
  
    <li><a href="../../Nucleon/Action/Node/Exec.html">Nucleon::Action::Node::Exec</a>
  
    <li><a href="../../Nucleon/Action/Node/Fact.html">Nucleon::Action::Node::Fact</a>
  
    <li><a href="../../Nucleon/Action/Node/Facts.html">Nucleon::Action::Node::Facts</a>
  
    <li><a href="../../Nucleon/Action/Node/Group.html">Nucleon::Action::Node::Group</a>
  
    <li><a href="../../Nucleon/Action/Node/Groups.html">Nucleon::Action::Node::Groups</a>
  
    <li><a href="../../Nucleon/Action/Node/IP.html">Nucleon::Action::Node::IP</a>
  
    <li><a href="../../Nucleon/Action/Node/Identity.html">Nucleon::Action::Node::Identity</a>
  
    <li><a href="../../Nucleon/Action/Node/Image.html">Nucleon::Action::Node::Image</a>
  
    <li><a href="../../Nucleon/Action/Node/Keypair.html">Nucleon::Action::Node::Keypair</a>
  
    <li><a href="../../Nucleon/Action/Node/Lookup.html">Nucleon::Action::Node::Lookup</a>
  
    <li><a href="../../Nucleon/Action/Node/Provision.html">Nucleon::Action::Node::Provision</a>
  
    <li><a href="../../Nucleon/Action/Node/Reboot.html">Nucleon::Action::Node::Reboot</a>
  
    <li><a href="../../Nucleon/Action/Node/Revoke.html">Nucleon::Action::Node::Revoke</a>
  
    <li><a href="../../Nucleon/Action/Node/SSH.html">Nucleon::Action::Node::SSH</a>
  
    <li><a href="../../Nucleon/Action/Node/Seed.html">Nucleon::Action::Node::Seed</a>
  
    <li><a href="../../Nucleon/Action/Node/Spawn.html">Nucleon::Action::Node::Spawn</a>
  
    <li><a href="../../Nucleon/Action/Node/Start.html">Nucleon::Action::Node::Start</a>
  
    <li><a href="../../Nucleon/Action/Node/Status.html">Nucleon::Action::Node::Status</a>
  
    <li><a href="../../Nucleon/Action/Node/Stop.html">Nucleon::Action::Node::Stop</a>
  
    <li><a href="../../Nucleon/Action/Plugin.html">Nucleon::Action::Plugin</a>
  
    <li><a href="../../Nucleon/Action/Plugin/Create.html">Nucleon::Action::Plugin::Create</a>
  
    <li><a href="../../Nucleon/Action/Plugin/List.html">Nucleon::Action::Plugin::List</a>
  
    <li><a href="../../Nucleon/Action/Plugins.html">Nucleon::Action::Plugins</a>
  
    <li><a href="../../Nucleon/Config.html">Nucleon::Config</a>
  
    <li><a href="../../Nucleon/Event.html">Nucleon::Event</a>
  
    <li><a href="../../Nucleon/Event/Puppet.html">Nucleon::Event::Puppet</a>
  
    <li><a href="../../Nucleon/Extension.html">Nucleon::Extension</a>
  
    <li><a href="../../Nucleon/Extension/CorlConfig.html">Nucleon::Extension::CorlConfig</a>
  
    <li><a href="../../Nucleon/Extension/Vagrant.html">Nucleon::Extension::Vagrant</a>
  
    <li><a href="../../Nucleon/Plugin.html">Nucleon::Plugin</a>
  
    <li><a href="../../Nucleon/Plugin/Agent.html">Nucleon::Plugin::Agent</a>
  
    <li><a href="../../Nucleon/Plugin/Base.html">Nucleon::Plugin::Base</a>
  
    <li><a href="../../Nucleon/Plugin/CloudAction.html">Nucleon::Plugin::CloudAction</a>
  
    <li><a href="../../Nucleon/Template.html">Nucleon::Template</a>
  
    <li><a href="../../Nucleon/Template/Environment.html">Nucleon::Template::Environment</a>
  
    <li><a href="../../VagrantPlugins.html">VagrantPlugins</a>
  
    <li><a href="../../VagrantPlugins/CORL.html">VagrantPlugins::CORL</a>
  
    <li><a href="../../VagrantPlugins/CORL/Action.html">VagrantPlugins::CORL::Action</a>
  
    <li><a href="../../VagrantPlugins/CORL/Action/DeleteCache.html">VagrantPlugins::CORL::Action::DeleteCache</a>
  
    <li><a href="../../VagrantPlugins/CORL/Action/IncludeOverrides.html">VagrantPlugins::CORL::Action::IncludeOverrides</a>
  
    <li><a href="../../VagrantPlugins/CORL/Action/InitKeys.html">VagrantPlugins::CORL::Action::InitKeys</a>
  
    <li><a href="../../VagrantPlugins/CORL/Action/LinkNetwork.html">VagrantPlugins::CORL::Action::LinkNetwork</a>
  
    <li><a href="../../VagrantPlugins/CORL/BaseAction.html">VagrantPlugins::CORL::BaseAction</a>
  
    <li><a href="../../VagrantPlugins/CORL/Command.html">VagrantPlugins::CORL::Command</a>
  
    <li><a href="../../VagrantPlugins/CORL/Command/Launcher.html">VagrantPlugins::CORL::Command::Launcher</a>
  
    <li><a href="../../VagrantPlugins/CORL/Config.html">VagrantPlugins::CORL::Config</a>
  
    <li><a href="../../VagrantPlugins/CORL/Config/CORL.html">VagrantPlugins::CORL::Config::CORL</a>
  
    <li><a href="../../VagrantPlugins/CORL/Plugin.html">VagrantPlugins::CORL::Plugin</a>
  
    <li><a href="../../VagrantPlugins/CORL/Provisioner.html">VagrantPlugins::CORL::Provisioner</a>
  
    <li><a href="../../VagrantPlugins/CORL/Provisioner/CORL.html">VagrantPlugins::CORL::Provisioner::CORL</a>
  
    <li><a href="../../VagrantPlugins/CommunicatorSSH.html">VagrantPlugins::CommunicatorSSH</a>
  
    <li><a href="../../VagrantPlugins/CommunicatorSSH/Communicator.html">VagrantPlugins::CommunicatorSSH::Communicator</a>
  
    <li><a href="../../Puppet.html">Puppet</a>
  
    <li><a href="../../Puppet/DataBinding.html">Puppet::DataBinding</a>
  
    <li><a href="../../Puppet/DataBinding/Corl.html">Puppet::DataBinding::Corl</a>
  
    <li><a href="../../Puppet/Indirector.html">Puppet::Indirector</a>
  
    <li><a href="../../Puppet/Indirector/Corl.html">Puppet::Indirector::Corl</a>
  
    <li><a href="../../Puppet/Parser.html">Puppet::Parser</a>
  
    <li><a href="../../Puppet/Parser/Functions.html">Puppet::Parser::Functions</a>
  
    <li><a href="../../Fog.html">Fog</a>
  
    <li><a href="../../Fog/Compute.html">Fog::Compute</a>
  
    <li><a href="../../Fog/Compute/AWS.html">Fog::Compute::AWS</a>
  
    <li><a href="../../Fog/Compute/AWS/Server.html">Fog::Compute::AWS::Server</a>
  
    <li><a href="../../Fog/Compute/RackspaceV2.html">Fog::Compute::RackspaceV2</a>
  
    <li><a href="../../Fog/Compute/RackspaceV2/Server.html">Fog::Compute::RackspaceV2::Server</a>
  
    <li><a href="../../Vagrant.html">Vagrant</a>
  
    <li><a href="../../Vagrant/Config.html">Vagrant::Config</a>
  
    <li><a href="../../Vagrant/Config/Loader.html">Vagrant::Config::Loader</a>
  
    <li><a href="../../Vagrant/Vagrantfile.html">Vagrant::Vagrantfile</a>
  
    <li><a href="../../Hiera.html">Hiera</a>
  
    <li><a href="../../Hiera/Backend.html">Hiera::Backend</a>
  
    <li><a href="../../Hiera/Corl_logger.html">Hiera::Corl_logger</a>
  
    <li><a href="../../Object.html">Object</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class CORL::Plugin::Node</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-build_info" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_info</span><span
            class="method-args">(namespace, plugin_type, data)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="build_info-doc">
            
            
            
          </div><!-- build_info-doc -->

          
          <div class="method-source-code" id="build_info-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1313</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">build_info</span>(<span class="ruby-identifier">namespace</span>, <span class="ruby-identifier">plugin_type</span>, <span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\s*,\s*/</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">namespace</span>, <span class="ruby-identifier">plugin_type</span>, <span class="ruby-identifier">data</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- build_info-source -->
          
        </div>

        

        
      </div><!-- build_info-method -->

    
      <div id="method-c-translate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">translate</span><span
            class="method-args">(data)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="translate-doc">
            
            
            
          </div><!-- translate-doc -->

          
          <div class="method-source-code" id="translate-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1320</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">translate</span>(<span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">options</span> = <span class="ruby-keyword">super</span>(<span class="ruby-identifier">data</span>)

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">data</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>
    <span class="ruby-identifier">options</span> = { <span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">data</span> }
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>
    <span class="ruby-identifier">options</span> = <span class="ruby-identifier">data</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:name</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">matches</span> = <span class="ruby-identifier">translate_reference</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:name</span>])
      <span class="ruby-identifier">options</span>[<span class="ruby-value">:provider</span>] = <span class="ruby-identifier">matches</span>[<span class="ruby-value">:provider</span>]
      <span class="ruby-identifier">options</span>[<span class="ruby-value">:name</span>]     = <span class="ruby-identifier">matches</span>[<span class="ruby-value">:name</span>]

      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Translating node options: #{options.inspect}&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">options</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- translate-source -->
          
        </div>

        

        
      </div><!-- translate-method -->

    
      <div id="method-c-translate_reference" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">translate_reference</span><span
            class="method-args">(reference)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="translate_reference-doc">
            
            
            
          </div><!-- translate_reference-doc -->

          
          <div class="method-source-code" id="translate_reference-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1343</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">translate_reference</span>(<span class="ruby-identifier">reference</span>)
  <span class="ruby-comment"># ex: rackspace:::web1.staging.example.com</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">reference</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">reference</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/^\s*([a-zA-Z0-9_-]+):::([^\s]+)\s*$/</span>)
    <span class="ruby-identifier">provider</span> = <span class="ruby-node">$1</span>
    <span class="ruby-identifier">name</span>     = <span class="ruby-node">$2</span>

    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Translating node reference: #{provider}  #{name}&quot;</span>)

    <span class="ruby-identifier">info</span> = {
      <span class="ruby-value">:provider</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">provider</span>,
      <span class="ruby-value">:name</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">name</span>
    }

    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Project reference info: #{info.inspect}&quot;</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">info</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- translate_reference-source -->
          
        </div>

        

        
      </div><!-- translate_reference-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-action" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">action</span><span
            class="method-args">(provider, options = {}) { |op, data| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="action-doc">
            
            
            
          </div><!-- action-doc -->

          
          <div class="method-source-code" id="action-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 917</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">action</span>(<span class="ruby-identifier">provider</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">codes</span> <span class="ruby-value">:network_load_error</span>

  <span class="ruby-identifier">config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>).<span class="ruby-identifier">defaults</span>({
    <span class="ruby-value">:log_level</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Nucleon</span>.<span class="ruby-identifier">log_level</span>,
    <span class="ruby-value">:net_remote</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:edit</span>,
    <span class="ruby-value">:net_provider</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">network</span>.<span class="ruby-identifier">plugin_provider</span>
  })

  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Executing remote action #{provider} with encoded arguments: #{config.export.inspect}&quot;</span>)

  <span class="ruby-identifier">encoded_config</span> = <span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">CLI</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>.<span class="ruby-identifier">clean</span>(<span class="ruby-identifier">config</span>.<span class="ruby-identifier">export</span>))
  <span class="ruby-identifier">action_config</span>  = <span class="ruby-identifier">extended_config</span>(<span class="ruby-value">:action</span>, {
    <span class="ruby-value">:command</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">provider</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;_&#39;</span>, <span class="ruby-string">&#39; &#39;</span>),
    <span class="ruby-value">:data</span>    =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:encoded</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">encoded_config</span> }
  })

  <span class="ruby-identifier">quiet</span>    = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:quiet</span>, <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">parallel</span> = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:parallel</span>, <span class="ruby-keyword">true</span>)

  <span class="ruby-identifier">command_base</span>  = <span class="ruby-string">&#39;corl&#39;</span>
  <span class="ruby-identifier">command_base</span>  = <span class="ruby-node">&quot;NUCLEON_NO_PARALLEL=1 #{command_base}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">parallel</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">command</span>(<span class="ruby-identifier">command_base</span>, { <span class="ruby-value">:subcommand</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">action_config</span>, <span class="ruby-value">:as_admin</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:quiet</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">quiet</span> }) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">op</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">yield</span>(<span class="ruby-identifier">op</span>, <span class="ruby-identifier">data</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Update local network configuration so we capture any updates</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">network</span>.<span class="ruby-identifier">load</span>({ <span class="ruby-value">:remote</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span>[<span class="ruby-value">:net_remote</span>], <span class="ruby-value">:pull</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> })
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">code</span>.<span class="ruby-identifier">network_load_error</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- action-source -->
          
        </div>

        

        
      </div><!-- action-method -->

    
      <div id="method-i-add_agent" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_agent</span><span
            class="method-args">(provider, settings)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="add_agent-doc">
            
            
            
          </div><!-- add_agent-doc -->

          
          <div class="method-source-code" id="add_agent-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 387</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_agent</span>(<span class="ruby-identifier">provider</span>, <span class="ruby-identifier">settings</span>)
  <span class="ruby-identifier">set_setting</span>([ <span class="ruby-value">:agents</span>, <span class="ruby-identifier">provider</span> ], <span class="ruby-constant">Config</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">settings</span>).<span class="ruby-identifier">export</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_agent-source -->
          
        </div>

        

        
      </div><!-- add_agent-method -->

    
      <div id="method-i-agent" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">agent</span><span
            class="method-args">(provider)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="agent-doc">
            
            
            
          </div><!-- agent-doc -->

          
          <div class="method-source-code" id="agent-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 383</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">agent</span>(<span class="ruby-identifier">provider</span>)
  <span class="ruby-identifier">search</span>([ <span class="ruby-value">:agents</span>, <span class="ruby-identifier">provider</span> ], {}, <span class="ruby-value">:hash</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- agent-source -->
          
        </div>

        

        
      </div><!-- agent-method -->

    
      <div id="method-i-agents" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">agents</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="agents-doc">
            
            
            
          </div><!-- agents-doc -->

          
          <div class="method-source-code" id="agents-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 379</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">agents</span>
  <span class="ruby-identifier">hash</span>(<span class="ruby-identifier">myself</span>[<span class="ruby-value">:agents</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- agents-source -->
          
        </div>

        

        
      </div><!-- agents-method -->

    
      <div id="method-i-attach_keys" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">attach_keys</span><span
            class="method-args">(keypair)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="attach_keys-doc">
            
            
            
          </div><!-- attach_keys-doc -->

          
          <div class="method-source-code" id="attach_keys-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 593</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">attach_keys</span>(<span class="ruby-identifier">keypair</span>)
  <span class="ruby-identifier">base_name</span>   = <span class="ruby-node">&quot;#{plugin_provider}-#{plugin_name}&quot;</span>
  <span class="ruby-identifier">save_config</span> = {
    <span class="ruby-value">:pull</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>,
    <span class="ruby-value">:push</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>,
    <span class="ruby-value">:message</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;Updating SSH keys for node #{plugin_provider} (#{plugin_name})&quot;</span>
  }

  <span class="ruby-identifier">active</span>  = <span class="ruby-identifier">machine</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">running?</span>
  <span class="ruby-identifier">result</span>  = <span class="ruby-identifier">run</span>.<span class="ruby-identifier">authorize</span>({ <span class="ruby-value">:public_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">keypair</span>.<span class="ruby-identifier">ssh_key</span> }) <span class="ruby-keyword">if</span> <span class="ruby-identifier">active</span>
  <span class="ruby-identifier">success</span> = <span class="ruby-keyword">false</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">active</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>
    <span class="ruby-identifier">private_key</span> = <span class="ruby-identifier">network</span>.<span class="ruby-identifier">attach_data</span>(<span class="ruby-value">:keys</span>, <span class="ruby-node">&quot;#{base_name}-id_#{keypair.type}&quot;</span>, <span class="ruby-identifier">keypair</span>.<span class="ruby-identifier">encrypted_key</span>)
    <span class="ruby-identifier">public_key</span>  = <span class="ruby-identifier">network</span>.<span class="ruby-identifier">attach_data</span>(<span class="ruby-value">:keys</span>, <span class="ruby-node">&quot;#{base_name}-id_#{keypair.type}.pub&quot;</span>, <span class="ruby-identifier">keypair</span>.<span class="ruby-identifier">ssh_key</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">private_key</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">public_key</span>
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">chmod</span>(<span class="ruby-value">0600</span>, <span class="ruby-identifier">private_key</span>)
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">chmod</span>(<span class="ruby-value">0644</span>, <span class="ruby-identifier">public_key</span>)

      <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">keypair</span> = <span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span>.<span class="ruby-identifier">generate</span>({ <span class="ruby-value">:private_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">keypair</span>.<span class="ruby-identifier">private_key</span> })
      <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">keypair</span>.<span class="ruby-identifier">store</span>(<span class="ruby-identifier">network</span>.<span class="ruby-identifier">key_cache_directory</span>, <span class="ruby-identifier">plugin_name</span>)

      <span class="ruby-identifier">save_config</span>[<span class="ruby-value">:files</span>] = [ <span class="ruby-identifier">private_key</span>, <span class="ruby-identifier">public_key</span> ]

      <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">private_key</span> = <span class="ruby-identifier">private_key</span>
      <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">public_key</span>  = <span class="ruby-identifier">public_key</span>

      <span class="ruby-identifier">success</span> = <span class="ruby-identifier">save</span>(<span class="ruby-identifier">extended_config</span>(<span class="ruby-value">:key_save</span>, <span class="ruby-identifier">save_config</span>))
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- attach_keys-source -->
          
        </div>

        

        
      </div><!-- attach_keys-method -->

    
      <div id="method-i-bootstrap" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bootstrap</span><span
            class="method-args">(local_path, options = {}) { |"send_| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="bootstrap-doc">
            
            
            
          </div><!-- bootstrap-doc -->

          
          <div class="method-source-code" id="bootstrap-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 991</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">bootstrap</span>(<span class="ruby-identifier">local_path</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">config</span>      = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">code</span>.<span class="ruby-identifier">unknown_status</span>

  <span class="ruby-identifier">bootstrap_name</span>    = <span class="ruby-string">&#39;bootstrap&#39;</span>
  <span class="ruby-identifier">bootstrap_path</span>    = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:bootstrap_path</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">CORL</span>.<span class="ruby-identifier">lib_path</span>, <span class="ruby-string">&#39;..&#39;</span>, <span class="ruby-identifier">bootstrap_name</span>))
  <span class="ruby-identifier">bootstrap_glob</span>    = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:bootstrap_glob</span>, <span class="ruby-string">&#39;**/*.sh&#39;</span>)
  <span class="ruby-identifier">bootstrap_init</span>    = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:bootstrap_init</span>, <span class="ruby-string">&#39;bootstrap.sh&#39;</span>)
  <span class="ruby-identifier">bootstrap_scripts</span> = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get_array</span>(<span class="ruby-value">:bootstrap_scripts</span>)

  <span class="ruby-identifier">user_home</span>  = <span class="ruby-identifier">config</span>[<span class="ruby-value">:home</span>]
  <span class="ruby-identifier">auth_files</span> = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get_array</span>(<span class="ruby-value">:auth_files</span>)

  <span class="ruby-identifier">reboot</span>       = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:reboot</span>, <span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">dev_build</span>    = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:dev_build</span>, <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">ruby_version</span> = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:ruby_version</span>, <span class="ruby-keyword">nil</span>)

  <span class="ruby-identifier">codes</span> <span class="ruby-value">:local_path_not_found</span>,
        <span class="ruby-value">:home_path_lookup_failure</span>,
        <span class="ruby-value">:auth_upload_failure</span>,
        <span class="ruby-value">:root_auth_copy_failure</span>,
        <span class="ruby-value">:bootstrap_upload_failure</span>,
        <span class="ruby-value">:bootstrap_exec_failure</span>,
        <span class="ruby-value">:reload_failure</span>

  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">local_path</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">user_home</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">user_home</span> = <span class="ruby-identifier">home</span>(<span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:home_env_var</span>, <span class="ruby-string">&#39;HOME&#39;</span>), <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:force</span>, <span class="ruby-keyword">false</span>))
      <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>

      <span class="ruby-comment"># Transmit authorisation / credential files</span>
      <span class="ruby-identifier">package_files</span> = [ <span class="ruby-string">&#39;.fog&#39;</span>, <span class="ruby-string">&#39;.netrc&#39;</span>, <span class="ruby-string">&#39;.google-privatekey.p12&#39;</span>, <span class="ruby-string">&#39;.vimrc&#39;</span> ]
      <span class="ruby-identifier">auth_files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">package_files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-identifier">local_path</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;/&#39;</span>, <span class="ruby-string">&#39;&#39;</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">send_success</span> = <span class="ruby-identifier">send_files</span>(<span class="ruby-identifier">local_path</span>, <span class="ruby-identifier">user_home</span>, <span class="ruby-identifier">package_files</span>, <span class="ruby-string">&#39;0600&#39;</span>, { <span class="ruby-value">:quiet</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> }) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">op</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">yield</span>(<span class="ruby-node">&quot;send_#{op}&quot;</span>.<span class="ruby-identifier">to_sym</span>, <span class="ruby-identifier">data</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
        <span class="ruby-identifier">data</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">send_success</span>
        <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">code</span>.<span class="ruby-identifier">auth_upload_failure</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">to_sym</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:root_user</span>, <span class="ruby-value">:root</span>).<span class="ruby-identifier">to_sym</span>
        <span class="ruby-identifier">auth_files</span>     = <span class="ruby-identifier">package_files</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;&#39;#{path}&#39;&quot;</span>}
        <span class="ruby-identifier">root_home_path</span> = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:root_home</span>, <span class="ruby-string">&#39;/root&#39;</span>)

        <span class="ruby-identifier">result</span>        = <span class="ruby-identifier">command</span>(<span class="ruby-node">&quot;cp #{auth_files.join(&#39; &#39;)} #{root_home_path}&quot;</span>, { <span class="ruby-value">:as_admin</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:admin_command</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;sudo&#39;</span> })
        <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">code</span>.<span class="ruby-identifier">root_auth_copy_failure</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># Send bootstrap package</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>
        <span class="ruby-identifier">remote_bootstrap_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">user_home</span>, <span class="ruby-identifier">bootstrap_name</span>)

        <span class="ruby-identifier">cli</span>.<span class="ruby-identifier">rm</span>(<span class="ruby-string">&#39;-Rf&#39;</span>, <span class="ruby-identifier">remote_bootstrap_path</span>)
        <span class="ruby-identifier">send_success</span> = <span class="ruby-identifier">send_files</span>(<span class="ruby-identifier">bootstrap_path</span>, <span class="ruby-identifier">remote_bootstrap_path</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&#39;0700&#39;</span>, { <span class="ruby-value">:quiet</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> }) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">op</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">yield</span>(<span class="ruby-node">&quot;send_#{op}&quot;</span>.<span class="ruby-identifier">to_sym</span>, <span class="ruby-identifier">data</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
          <span class="ruby-identifier">data</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">send_success</span>
          <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">code</span>.<span class="ruby-identifier">bootstrap_upload_failure</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-comment"># Execute bootstrap process</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>
          <span class="ruby-identifier">remote_script</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">remote_bootstrap_path</span>, <span class="ruby-identifier">bootstrap_init</span>)
          <span class="ruby-identifier">environment</span>   = <span class="ruby-node">&quot;HOSTNAME=&#39;#{hostname}&#39; &quot;</span>
          <span class="ruby-identifier">environment</span>  <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;DEVELOPMENT_BUILD=1 &quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">dev_build</span>
          <span class="ruby-identifier">environment</span>  <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;RUBY_RVM_VERSION=&#39;#{ruby_version}&#39; &quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ruby_version</span>
          <span class="ruby-identifier">script_names</span>  = <span class="ruby-identifier">bootstrap_scripts</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">bootstrap_scripts</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>)

          <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">bootstrap_script</span> = <span class="ruby-identifier">remote_script</span>

          <span class="ruby-identifier">result</span> = <span class="ruby-identifier">command</span>(<span class="ruby-node">&quot;#{environment} #{remote_script} #{script_names}&quot;</span>, { <span class="ruby-value">:as_admin</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> }) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">op</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">yield</span>(<span class="ruby-node">&quot;exec_#{op}&quot;</span>.<span class="ruby-identifier">to_sym</span>, <span class="ruby-identifier">data</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
            <span class="ruby-identifier">data</span>
          <span class="ruby-keyword">end</span>

          <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>
            <span class="ruby-comment"># Reboot the machine</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">reboot</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">reload</span>
              <span class="ruby-identifier">warn</span>(<span class="ruby-string">&#39;corl.core.node.bootstrap.reload&#39;</span>)
              <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">code</span>.<span class="ruby-identifier">reload_failure</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">warn</span>(<span class="ruby-string">&#39;corl.core.node.bootstrap.status&#39;</span>, { <span class="ruby-value">:script</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">remote_script</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">status</span> })
            <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">code</span>.<span class="ruby-identifier">bootstrap_exec_failure</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">code</span>.<span class="ruby-identifier">home_path_lookup_failure</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">code</span>.<span class="ruby-identifier">local_path_not_found</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- bootstrap-source -->
          
        </div>

        

        
      </div><!-- bootstrap-method -->

    
      <div id="method-i-bootstrap_script" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bootstrap_script</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="bootstrap_script-doc">
            
            
            
          </div><!-- bootstrap_script-doc -->

          
          <div class="method-source-code" id="bootstrap_script-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 373</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">bootstrap_script</span>
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:bootstrap</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- bootstrap_script-source -->
          
        </div>

        

        
      </div><!-- bootstrap_script-method -->

    
      <div id="method-i-bootstrap_script-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bootstrap_script=</span><span
            class="method-args">(bootstrap)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="bootstrap_script-3D-doc">
            
            
            
          </div><!-- bootstrap_script-3D-doc -->

          
          <div class="method-source-code" id="bootstrap_script-3D-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 369</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">bootstrap_script=</span><span class="ruby-identifier">bootstrap</span>
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:bootstrap</span>] = <span class="ruby-identifier">bootstrap</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- bootstrap_script-3D-source -->
          
        </div>

        

        
      </div><!-- bootstrap_script-3D-method -->

    
      <div id="method-i-build" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build</span><span
            class="method-args">(options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="build-doc">
            
            
            
          </div><!-- build-doc -->

          
          <div class="method-source-code" id="build-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 538</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build</span>(<span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">config</span>  = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">success</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-comment"># TODO: Figure out what&#39;s going on with the parallel implementation here.</span>
  <span class="ruby-identifier">parallel_original</span>          = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;NUCLEON_NO_PARALLEL&#39;</span>]
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;NUCLEON_NO_PARALLEL&#39;</span>] = <span class="ruby-string">&#39;true&#39;</span>

  <span class="ruby-identifier">status</span>  = <span class="ruby-identifier">parallel</span>(<span class="ruby-value">:build_provider</span>, <span class="ruby-identifier">network</span>.<span class="ruby-identifier">builders</span>, <span class="ruby-identifier">config</span>)
  <span class="ruby-identifier">success</span> = <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">status</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-keyword">false</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">array</span>(<span class="ruby-identifier">config</span>[<span class="ruby-value">:providers</span>]).<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">array</span>(<span class="ruby-identifier">config</span>[<span class="ruby-value">:providers</span>]).<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;package&quot;</span>)
      <span class="ruby-identifier">status</span>  = <span class="ruby-identifier">parallel</span>(<span class="ruby-value">:build_provisioners</span>, <span class="ruby-identifier">provisioners</span>, <span class="ruby-identifier">config</span>)
      <span class="ruby-identifier">success</span> = <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">status</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-keyword">false</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>
      <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">build_time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:save</span>, <span class="ruby-keyword">true</span>)
        <span class="ruby-identifier">success</span>(<span class="ruby-string">&quot;Saving successful build&quot;</span>, { <span class="ruby-value">:i18n</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> })

        <span class="ruby-identifier">success</span> = <span class="ruby-identifier">save</span>(<span class="ruby-identifier">extended_config</span>(<span class="ruby-value">:build</span>, {
          <span class="ruby-value">:message</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:message</span>, <span class="ruby-node">&quot;Built #{plugin_provider} node: #{plugin_name}&quot;</span>),
          <span class="ruby-value">:remote</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:remote</span>, <span class="ruby-value">:edit</span>)
        }))
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;NUCLEON_NO_PARALLEL&#39;</span>] = <span class="ruby-identifier">parallel_original</span>
  <span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- build-source -->
          
        </div>

        

        
      </div><!-- build-method -->

    
      <div id="method-i-build_provider" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_provider</span><span
            class="method-args">(provider, plugin, config)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="build_provider-doc">
            
            
            
          </div><!-- build_provider-doc -->

          
          <div class="method-source-code" id="build_provider-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 573</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_provider</span>(<span class="ruby-identifier">provider</span>, <span class="ruby-identifier">plugin</span>, <span class="ruby-identifier">config</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">array</span>(<span class="ruby-identifier">config</span>[<span class="ruby-value">:providers</span>]).<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">array</span>(<span class="ruby-identifier">config</span>[<span class="ruby-value">:providers</span>]).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">provider</span>.<span class="ruby-identifier">to_s</span>)
    <span class="ruby-comment">#info(&quot;Building #{provider} components&quot;, { :i18n =&gt; false })</span>
    <span class="ruby-identifier">plugin</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">myself</span>, <span class="ruby-identifier">config</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- build_provider-source -->
          
        </div>

        

        
      </div><!-- build_provider-method -->

    
      <div id="method-i-build_provisioner" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_provisioner</span><span
            class="method-args">(name, plugin, provider, config)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="build_provisioner-doc">
            
            
            
          </div><!-- build_provisioner-doc -->

          
          <div class="method-source-code" id="build_provisioner-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 586</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_provisioner</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">plugin</span>, <span class="ruby-identifier">provider</span>, <span class="ruby-identifier">config</span>)
  <span class="ruby-comment">#info(&quot;Building #{provider} #{name} provisioner components&quot;, { :i18n =&gt; false })</span>
  <span class="ruby-identifier">plugin</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">myself</span>, <span class="ruby-identifier">config</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- build_provisioner-source -->
          
        </div>

        

        
      </div><!-- build_provisioner-method -->

    
      <div id="method-i-build_provisioners" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_provisioners</span><span
            class="method-args">(provider, collection, config)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="build_provisioners-doc">
            
            
            
          </div><!-- build_provisioners-doc -->

          
          <div class="method-source-code" id="build_provisioners-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 580</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_provisioners</span>(<span class="ruby-identifier">provider</span>, <span class="ruby-identifier">collection</span>, <span class="ruby-identifier">config</span>)
  <span class="ruby-comment">#info(&quot;Building #{provider} provisioner collection&quot;, { :i18n =&gt; false })</span>
  <span class="ruby-identifier">status</span> = <span class="ruby-identifier">parallel</span>(<span class="ruby-value">:build_provisioner</span>, <span class="ruby-identifier">collection</span>, <span class="ruby-identifier">provider</span>, <span class="ruby-identifier">config</span>)
  <span class="ruby-identifier">status</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-keyword">false</span>) <span class="ruby-operator">?</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- build_provisioners-source -->
          
        </div>

        

        
      </div><!-- build_provisioners-method -->

    
      <div id="method-i-build_time" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_time</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="build_time-doc">
            
            
            
          </div><!-- build_time-doc -->

          
          <div class="method-source-code" id="build_time-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 363</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_time</span>
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:build</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- build_time-source -->
          
        </div>

        

        
      </div><!-- build_time-method -->

    
      <div id="method-i-build_time-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_time=</span><span
            class="method-args">(time)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="build_time-3D-doc">
            
            
            
          </div><!-- build_time-3D-doc -->

          
          <div class="method-source-code" id="build_time-3D-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 359</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_time=</span><span class="ruby-identifier">time</span>
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:build</span>] = <span class="ruby-identifier">time</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- build_time-3D-source -->
          
        </div>

        

        
      </div><!-- build_time-3D-method -->

    
      <div id="method-i-clear_remote_cache" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clear_remote_cache</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="clear_remote_cache-doc">
            
            
            
          </div><!-- clear_remote_cache-doc -->

          
          <div class="method-source-code" id="clear_remote_cache-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 531</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">clear_remote_cache</span>
  <span class="ruby-identifier">run</span>.<span class="ruby-identifier">node_cache</span>({ <span class="ruby-value">:clear</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> }).<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- clear_remote_cache-source -->
          
        </div>

        

        
      </div><!-- clear_remote_cache-method -->

    
      <div id="method-i-cli" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cli</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="cli-doc">
            
            
            
          </div><!-- cli-doc -->

          
          <div class="method-source-code" id="cli-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 881</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cli</span>
  <span class="ruby-ivar">@cli_interface</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- cli-source -->
          
        </div>

        

        
      </div><!-- cli-method -->

    
      <div id="method-i-cli_capture" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cli_capture</span><span
            class="method-args">(cli_command, *args)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="cli_capture-doc">
            
            
            
          </div><!-- cli_capture-doc -->

          
          <div class="method-source-code" id="cli_capture-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1371</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cli_capture</span>(<span class="ruby-identifier">cli_command</span>, *<span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">exec</span>({ <span class="ruby-value">:commands</span> =<span class="ruby-operator">&gt;</span> [ [ <span class="ruby-identifier">cli_command</span>, <span class="ruby-identifier">args</span> ].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>) ], <span class="ruby-value">:quiet</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> })
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">result</span>.<span class="ruby-identifier">first</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">output</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">output</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- cli_capture-source -->
          
        </div>

        

        
      </div><!-- cli_capture-method -->

    
      <div id="method-i-cli_check" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cli_check</span><span
            class="method-args">(cli_command, *args)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="cli_check-doc">
            
            
            
          </div><!-- cli_check-doc -->

          
          <div class="method-source-code" id="cli_check-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1384</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cli_check</span>(<span class="ruby-identifier">cli_command</span>, *<span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">cli</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">cli_command</span>, <span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- cli_check-source -->
          
        </div>

        

        
      </div><!-- cli_check-method -->

    
      <div id="method-i-command" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">command</span><span
            class="method-args">(command, options = {}) { |op, data| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="command-doc">
            
            
            
          </div><!-- command-doc -->

          
          <div class="method-source-code" id="command-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 887</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">command</span>(<span class="ruby-identifier">command</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">config</span>         = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">as_admin</span>       = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:as_admin</span>, <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">remove_command</span> = <span class="ruby-keyword">false</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">command</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CORL</span><span class="ruby-operator">::</span><span class="ruby-constant">Plugin</span><span class="ruby-operator">::</span><span class="ruby-constant">Command</span>)
    <span class="ruby-identifier">command</span>        = <span class="ruby-constant">CORL</span>.<span class="ruby-identifier">command</span>(<span class="ruby-constant">Config</span>.<span class="ruby-identifier">new</span>({ <span class="ruby-value">:command</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">command</span> }, {}, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>).<span class="ruby-identifier">import</span>(<span class="ruby-identifier">config</span>), <span class="ruby-value">:bash</span>)
    <span class="ruby-identifier">remove_command</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">admin_command</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">as_admin</span>
    <span class="ruby-identifier">admin_command</span> = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:admin_command</span>, <span class="ruby-string">&#39;sudo -i&#39;</span>)
    <span class="ruby-identifier">admin_command</span> = <span class="ruby-identifier">extension_set</span>(<span class="ruby-value">:admin_command</span>, <span class="ruby-identifier">admin_command</span>, <span class="ruby-identifier">config</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">config</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:admin_command</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">config</span>[<span class="ruby-value">:commands</span>] = [ <span class="ruby-node">&quot;#{admin_command} #{command.to_s}&quot;</span>.<span class="ruby-identifier">strip</span> ]

  <span class="ruby-identifier">results</span> = <span class="ruby-identifier">exec</span>(<span class="ruby-identifier">config</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">op</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">yield</span>(<span class="ruby-identifier">op</span>, <span class="ruby-identifier">data</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">CORL</span>.<span class="ruby-identifier">remove_plugin</span>(<span class="ruby-identifier">command</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">remove_command</span>
  <span class="ruby-identifier">results</span>.<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- command-source -->
          
        </div>

        

        
      </div><!-- command-method -->

    
      <div id="method-i-create" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create</span><span
            class="method-args">(options = {}) { |:config, config| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="create-doc">
            
            
            
          </div><!-- create-doc -->

          
          <div class="method-source-code" id="create-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 667</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create</span>(<span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">success</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span>
    <span class="ruby-identifier">config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>)

    <span class="ruby-identifier">clear_cache</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">extension_check</span>(<span class="ruby-value">:create</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> })
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Creating node: #{plugin_name}&quot;</span>)

      <span class="ruby-keyword">yield</span>(<span class="ruby-value">:config</span>, <span class="ruby-identifier">config</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
      <span class="ruby-identifier">success</span> = <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">config</span>.<span class="ruby-identifier">export</span>)

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">block_given?</span>
        <span class="ruby-identifier">process_success</span> = <span class="ruby-keyword">yield</span>(<span class="ruby-value">:process</span>, <span class="ruby-identifier">config</span>)
        <span class="ruby-identifier">success</span>         = <span class="ruby-identifier">process_success</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">process_success</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>
        <span class="ruby-identifier">extension</span>(<span class="ruby-value">:create_success</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> })
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Node #{plugin_name} does not have an attached machine so cannot be created&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create-source -->
          
        </div>

        

        
      </div><!-- create-method -->

    
      <div id="method-i-create_facts_post" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_facts_post</span><span
            class="method-args">(data, names)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="create_facts_post-doc">
            
            
            
          </div><!-- create_facts_post-doc -->

          
          <div class="method-source-code" id="create_facts_post-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 447</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_facts_post</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">names</span>)
  <span class="ruby-identifier">fact_values</span> = {}
  <span class="ruby-identifier">names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">name</span>              = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_sym</span>
    <span class="ruby-identifier">fact_values</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">data</span>[<span class="ruby-identifier">name</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">ensure_custom_facts</span>(<span class="ruby-identifier">fact_values</span>)
  <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_facts_post-source -->
          
        </div>

        

        
      </div><!-- create_facts_post-method -->

    
      <div id="method-i-create_image" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_image</span><span
            class="method-args">(options = {}) { |:config, config| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="create_image-doc">
            
            
            
          </div><!-- create_image-doc -->

          
          <div class="method-source-code" id="create_image-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1192</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_image</span>(<span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">success</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">running?</span>
    <span class="ruby-identifier">config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">extension_check</span>(<span class="ruby-value">:create_image</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> })
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Executing node: #{plugin_name}&quot;</span>)

      <span class="ruby-keyword">yield</span>(<span class="ruby-value">:config</span>, <span class="ruby-identifier">config</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
      <span class="ruby-identifier">success</span> = <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">create_image</span>(<span class="ruby-identifier">config</span>.<span class="ruby-identifier">export</span>)
      <span class="ruby-identifier">success</span> = <span class="ruby-identifier">save</span>(<span class="ruby-identifier">config</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">block_given?</span>
        <span class="ruby-identifier">process_success</span> = <span class="ruby-keyword">yield</span>(<span class="ruby-value">:process</span>, <span class="ruby-identifier">config</span>)
        <span class="ruby-identifier">success</span>         = <span class="ruby-identifier">process_success</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">process_success</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>
        <span class="ruby-identifier">extension</span>(<span class="ruby-value">:create_image_success</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> })
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Node #{plugin_name} does not have an attached machine or is not running so cannot create an image&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_image-source -->
          
        </div>

        

        
      </div><!-- create_image-method -->

    
      <div id="method-i-create_machine" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_machine</span><span
            class="method-args">(name, provider, options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="create_machine-doc">
            
            
            
          </div><!-- create_machine-doc -->

          
          <div class="method-source-code" id="create_machine-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 661</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_machine</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">provider</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-constant">CORL</span>.<span class="ruby-identifier">create_plugin</span>(<span class="ruby-value">:CORL</span>, <span class="ruby-value">:machine</span>, <span class="ruby-identifier">provider</span>, <span class="ruby-identifier">extended_config</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">options</span>).<span class="ruby-identifier">import</span>({ <span class="ruby-value">:meta</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:parent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">myself</span> }}))
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_machine-source -->
          
        </div>

        

        
      </div><!-- create_machine-method -->

    
      <div id="method-i-custom_facts" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">custom_facts</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="custom_facts-doc">
            
            
            
          </div><!-- custom_facts-doc -->

          
          <div class="method-source-code" id="custom_facts-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 304</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">custom_facts</span>
  <span class="ruby-identifier">search</span>(<span class="ruby-value">:facts</span>, {}, <span class="ruby-value">:hash</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- custom_facts-source -->
          
        </div>

        

        
      </div><!-- custom_facts-method -->

    
      <div id="method-i-custom_facts-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">custom_facts=</span><span
            class="method-args">(facts)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="custom_facts-3D-doc">
            
            
            
          </div><!-- custom_facts-3D-doc -->

          
          <div class="method-source-code" id="custom_facts-3D-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 300</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">custom_facts=</span><span class="ruby-identifier">facts</span>
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:facts</span>] = <span class="ruby-identifier">hash</span>(<span class="ruby-identifier">facts</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- custom_facts-3D-source -->
          
        </div>

        

        
      </div><!-- custom_facts-3D-method -->

    
      <div id="method-i-delete_facts_post" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_facts_post</span><span
            class="method-args">(data, old_data)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="delete_facts_post-doc">
            
            
            
          </div><!-- delete_facts_post-doc -->

          
          <div class="method-source-code" id="delete_facts_post-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 459</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_facts_post</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">old_data</span>)
  <span class="ruby-identifier">remove_custom_facts</span>(*<span class="ruby-identifier">old_data</span>.<span class="ruby-identifier">keys</span>)
  <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- delete_facts_post-source -->
          
        </div>

        

        
      </div><!-- delete_facts_post-method -->

    
      <div id="method-i-delete_keys" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_keys</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="delete_keys-doc">
            
            
            
          </div><!-- delete_keys-doc -->

          
          <div class="method-source-code" id="delete_keys-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 629</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_keys</span>
  <span class="ruby-identifier">private_key</span> = <span class="ruby-identifier">myself</span>[<span class="ruby-value">:private_key</span>]
  <span class="ruby-identifier">public_key</span>  = <span class="ruby-identifier">myself</span>[<span class="ruby-value">:public_key</span>]

  <span class="ruby-identifier">keys</span> = []
  <span class="ruby-identifier">keys</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">private_key</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">private_key</span>
  <span class="ruby-identifier">keys</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">public_key</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">public_key</span>

  <span class="ruby-identifier">success</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">files</span> = <span class="ruby-identifier">network</span>.<span class="ruby-identifier">delete_attachments</span>(<span class="ruby-identifier">keys</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">files</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">delete_setting</span>(<span class="ruby-value">:private_key</span>)
      <span class="ruby-identifier">delete_setting</span>(<span class="ruby-value">:public_key</span>)

      <span class="ruby-identifier">success</span> = <span class="ruby-identifier">save</span>(<span class="ruby-identifier">extended_config</span>(<span class="ruby-value">:key_delete</span>, {
        <span class="ruby-value">:files</span>   =<span class="ruby-operator">&gt;</span> [ <span class="ruby-identifier">private_key</span>, <span class="ruby-identifier">public_key</span> ],
        <span class="ruby-value">:pull</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>,
        <span class="ruby-value">:push</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>,
        <span class="ruby-value">:message</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;Removing SSH keys for node #{plugin_provider} (#{plugin_name})&quot;</span>
      }))
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">success</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- delete_keys-source -->
          
        </div>

        

        
      </div><!-- delete_keys-method -->

    
      <div id="method-i-delete_remote_cache_setting" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_remote_cache_setting</span><span
            class="method-args">(keys)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="delete_remote_cache_setting-doc">
            
            
            
          </div><!-- delete_remote_cache_setting-doc -->

          
          <div class="method-source-code" id="delete_remote_cache_setting-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 522</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_remote_cache_setting</span>(<span class="ruby-identifier">keys</span>)
  <span class="ruby-identifier">run</span>.<span class="ruby-identifier">node_cache</span>({
    <span class="ruby-value">:name</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;.&#39;</span>),
    <span class="ruby-value">:delete</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
  }).<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- delete_remote_cache_setting-source -->
          
        </div>

        

        
      </div><!-- delete_remote_cache_setting-method -->

    
      <div id="method-i-destroy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">destroy</span><span
            class="method-args">(options = {}) { |:config, config| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="destroy-doc">
            
            
            
          </div><!-- destroy-doc -->

          
          <div class="method-source-code" id="destroy-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1267</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">destroy</span>(<span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">config</span>  = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">success</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">extension_check</span>(<span class="ruby-value">:destroy</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> })
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Destroying node: #{plugin_name}&quot;</span>)

    <span class="ruby-keyword">yield</span>(<span class="ruby-value">:config</span>, <span class="ruby-identifier">config</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">created?</span>
      <span class="ruby-comment"># Shut down machine</span>
      <span class="ruby-identifier">success</span> = <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">destroy</span>(<span class="ruby-identifier">config</span>.<span class="ruby-identifier">export</span>)
      <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">machine</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Node #{plugin_name} does not have an attached machine or is not created so cannot be destroyed&quot;</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># Remove SSH keys</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">delete_keys</span>
      <span class="ruby-comment"># Remove node information</span>
      <span class="ruby-identifier">network</span>.<span class="ruby-identifier">delete_node</span>(<span class="ruby-identifier">plugin_provider</span>, <span class="ruby-identifier">plugin_name</span>, <span class="ruby-keyword">false</span>)

      <span class="ruby-identifier">network</span>.<span class="ruby-identifier">save</span>({
        <span class="ruby-value">:commit</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>,
        <span class="ruby-value">:remote</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:remote</span>, <span class="ruby-value">:edit</span>),
        <span class="ruby-value">:message</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:message</span>, <span class="ruby-node">&quot;Destroying node #{plugin_name}&quot;</span>),
        <span class="ruby-value">:push</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
      })
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">block_given?</span>
      <span class="ruby-identifier">process_success</span> = <span class="ruby-keyword">yield</span>(<span class="ruby-value">:process</span>, <span class="ruby-identifier">config</span>)
      <span class="ruby-identifier">success</span>         = <span class="ruby-identifier">process_success</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">process_success</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>
      <span class="ruby-identifier">extension</span>(<span class="ruby-value">:destroy_success</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> })
      <span class="ruby-identifier">clear_cache</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- destroy-source -->
          
        </div>

        

        
      </div><!-- destroy-method -->

    
      <div id="method-i-download" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">download</span><span
            class="method-args">(remote_path, local_path, options = {}) { |:config, hook_config| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="download-doc">
            
            
            
          </div><!-- download-doc -->

          
          <div class="method-source-code" id="download-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 698</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">download</span>(<span class="ruby-identifier">remote_path</span>, <span class="ruby-identifier">local_path</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">success</span> = <span class="ruby-keyword">false</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">running?</span>
    <span class="ruby-identifier">config</span>      = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>)
    <span class="ruby-identifier">hook_config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">new</span>({ <span class="ruby-value">:local_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">local_path</span>, <span class="ruby-value">:remote_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">remote_path</span>, <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> }, {}, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>)
    <span class="ruby-identifier">quiet</span>       = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:quiet</span>, <span class="ruby-keyword">false</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">extension_check</span>(<span class="ruby-value">:download</span>, <span class="ruby-identifier">hook_config</span>)
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Downloading from #{plugin_name}&quot;</span>)

      <span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Starting download of #{remote_path} to #{local_path}&quot;</span>, { <span class="ruby-value">:i18n</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> }) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">quiet</span>
      <span class="ruby-keyword">yield</span>(<span class="ruby-value">:config</span>, <span class="ruby-identifier">hook_config</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>

      <span class="ruby-identifier">active_machine</span> = <span class="ruby-identifier">local?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">local_machine</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">machine</span>

      <span class="ruby-identifier">success</span> = <span class="ruby-identifier">active_machine</span>.<span class="ruby-identifier">download</span>(<span class="ruby-identifier">remote_path</span>, <span class="ruby-identifier">local_path</span>, <span class="ruby-identifier">config</span>.<span class="ruby-identifier">export</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">received</span>, <span class="ruby-identifier">total</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;#{name}: Sent #{received} of #{total}&quot;</span>, { <span class="ruby-value">:i18n</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> }) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">quiet</span>
        <span class="ruby-keyword">yield</span>(<span class="ruby-value">:progress</span>, { <span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">name</span>, <span class="ruby-value">:received</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">received</span>, <span class="ruby-value">:total</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">total</span> })
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">block_given?</span>
        <span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Successfully finished download of #{remote_path} to #{local_path}&quot;</span>, { <span class="ruby-value">:i18n</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> }) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">quiet</span>
        <span class="ruby-identifier">process_success</span> = <span class="ruby-keyword">yield</span>(<span class="ruby-value">:process</span>, <span class="ruby-identifier">hook_config</span>)
        <span class="ruby-identifier">success</span>         = <span class="ruby-identifier">process_success</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">process_success</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>
        <span class="ruby-identifier">extension</span>(<span class="ruby-value">:download_success</span>, <span class="ruby-identifier">hook_config</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Node #{plugin_name} does not have an attached machine or is not running so cannot download&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- download-source -->
          
        </div>

        

        
      </div><!-- download-method -->

    
      <div id="method-i-ensure_custom_facts" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ensure_custom_facts</span><span
            class="method-args">(facts)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="ensure_custom_facts-doc">
            
            
            
          </div><!-- ensure_custom_facts-doc -->

          
          <div class="method-source-code" id="ensure_custom_facts-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 308</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ensure_custom_facts</span>(<span class="ruby-identifier">facts</span>)
  <span class="ruby-identifier">hash</span>(<span class="ruby-identifier">facts</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">set_setting</span>([ <span class="ruby-value">:facts</span>, <span class="ruby-identifier">name</span> ], <span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- ensure_custom_facts-source -->
          
        </div>

        

        
      </div><!-- ensure_custom_facts-method -->

    
      <div id="method-i-exec" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">exec</span><span
            class="method-args">(options = {}) { |:config, config| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="exec-doc">
            
            
            
          </div><!-- exec-doc -->

          
          <div class="method-source-code" id="exec-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 809</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">exec</span>(<span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">default_error</span> = <span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Shell</span><span class="ruby-operator">::</span><span class="ruby-constant">Result</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">255</span>)
  <span class="ruby-identifier">results</span>       = [ <span class="ruby-identifier">default_error</span> ]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">local?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">local_machine</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">machine</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">running?</span>
    <span class="ruby-identifier">config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">extension_check</span>(<span class="ruby-value">:exec</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> })
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Executing node: #{plugin_name}&quot;</span>)

      <span class="ruby-keyword">yield</span>(<span class="ruby-value">:config</span>, <span class="ruby-identifier">config</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">local?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">local_machine</span>
        <span class="ruby-identifier">active_machine</span> = <span class="ruby-identifier">local_machine</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">active_machine</span> = <span class="ruby-identifier">machine</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">commands</span> = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:commands</span>, <span class="ruby-keyword">nil</span>)
        <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:quiet</span>, <span class="ruby-keyword">false</span>)

        <span class="ruby-keyword">begin</span>
          <span class="ruby-identifier">test</span> = <span class="ruby-identifier">active_machine</span>.<span class="ruby-identifier">exec</span>(<span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>.<span class="ruby-identifier">array</span>(<span class="ruby-identifier">commands</span>), <span class="ruby-identifier">config</span>.<span class="ruby-identifier">export</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span>, <span class="ruby-identifier">command</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">unless</span> <span class="ruby-identifier">quiet</span>
              <span class="ruby-keyword">unless</span> <span class="ruby-identifier">local?</span>
                <span class="ruby-identifier">text_output</span> = <span class="ruby-identifier">filter_output</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">data</span>).<span class="ruby-identifier">rstrip</span>

                <span class="ruby-keyword">unless</span> <span class="ruby-identifier">text_output</span>.<span class="ruby-identifier">empty?</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:error</span>
                    <span class="ruby-identifier">warn</span>(<span class="ruby-identifier">text_output</span>, { <span class="ruby-value">:i18n</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> })
                  <span class="ruby-keyword">else</span>
                    <span class="ruby-identifier">info</span>(<span class="ruby-identifier">text_output</span>, { <span class="ruby-value">:i18n</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> })
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">yield</span>(<span class="ruby-value">:progress</span>, { <span class="ruby-value">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">type</span>, <span class="ruby-value">:command</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">command</span>, <span class="ruby-value">:data</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">data</span> }) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">results</span> = <span class="ruby-identifier">test</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">test</span>

        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">error</span>
          <span class="ruby-identifier">default_error</span>.<span class="ruby-identifier">append_errors</span>(<span class="ruby-identifier">error</span>.<span class="ruby-identifier">message</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">default_error</span>.<span class="ruby-identifier">append_errors</span>(<span class="ruby-string">&quot;No execution command&quot;</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">results</span>
        <span class="ruby-identifier">success</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">results</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">result</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">success</span> = <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>
          <span class="ruby-keyword">yield</span>(<span class="ruby-value">:process</span>, <span class="ruby-identifier">config</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
          <span class="ruby-identifier">extension</span>(<span class="ruby-value">:exec_success</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span>, <span class="ruby-value">:results</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">results</span> })
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">default_error</span>.<span class="ruby-identifier">append_errors</span>(<span class="ruby-string">&quot;No execution results&quot;</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">default_error</span>.<span class="ruby-identifier">append_errors</span>(<span class="ruby-string">&quot;Execution prevented by exec hook&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">default_error</span>.<span class="ruby-identifier">append_errors</span>(<span class="ruby-string">&quot;No attached machine&quot;</span>)

    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Node #{plugin_name} does not have an attached machine or is not running so cannot execute commands&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">results</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- exec-source -->
          
        </div>

        

        
      </div><!-- exec-method -->

    
      <div id="method-i-fact_var" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fact_var</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="fact_var-doc">
            
            
            
          </div><!-- fact_var-doc -->

          
          <div class="method-source-code" id="fact_var-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 410</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">fact_var</span>
  <span class="ruby-ivar">@facts</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- fact_var-source -->
          
        </div>

        

        
      </div><!-- fact_var-method -->

    
      <div id="method-i-fact_var-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fact_var=</span><span
            class="method-args">(facts)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="fact_var-3D-doc">
            
            
            
          </div><!-- fact_var-3D-doc -->

          
          <div class="method-source-code" id="fact_var-3D-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 414</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">fact_var=</span><span class="ruby-identifier">facts</span>
  <span class="ruby-ivar">@facts</span> = <span class="ruby-identifier">facts</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- fact_var-3D-source -->
          
        </div>

        

        
      </div><!-- fact_var-3D-method -->

    
      <div id="method-i-facts" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">facts</span><span
            class="method-args">(reset = false, clone = true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="facts-doc">
            
            
            
          </div><!-- facts-doc -->

          
          <div class="method-source-code" id="facts-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 420</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">facts</span>(<span class="ruby-identifier">reset</span> = <span class="ruby-keyword">false</span>, <span class="ruby-identifier">clone</span> = <span class="ruby-keyword">true</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">reset</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">fact_var</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">default_facts</span> = <span class="ruby-identifier">extended_config</span>(<span class="ruby-value">:hiera_default_facts</span>, {
      <span class="ruby-value">:fqdn</span>          =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hostname</span>,
      <span class="ruby-value">:hostname</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hostname</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\..*$/</span>, <span class="ruby-string">&#39;&#39;</span>),
      <span class="ruby-value">:corl_provider</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">plugin_provider</span>.<span class="ruby-identifier">to_s</span>
    })

    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">local?</span>
      <span class="ruby-identifier">result</span> = <span class="ruby-identifier">run</span>.<span class="ruby-identifier">node_facts</span>({ <span class="ruby-value">:quiet</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> })

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>
        <span class="ruby-identifier">node_facts</span> = <span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>.<span class="ruby-identifier">symbol_map</span>(<span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>.<span class="ruby-identifier">parse_json</span>(<span class="ruby-identifier">result</span>.<span class="ruby-identifier">errors</span>))
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">node_facts</span>
      <span class="ruby-identifier">node_facts</span> = <span class="ruby-identifier">local?</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>.<span class="ruby-identifier">merge</span>([ <span class="ruby-constant">CORL</span>.<span class="ruby-identifier">facts</span>, <span class="ruby-identifier">custom_facts</span> ]) <span class="ruby-operator">:</span> <span class="ruby-identifier">custom_facts</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">fact_var</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">node_facts</span>, {}, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>).<span class="ruby-identifier">defaults</span>(<span class="ruby-identifier">default_facts</span>).<span class="ruby-identifier">export</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">fact_var</span>.<span class="ruby-identifier">clone</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">clone</span>
  <span class="ruby-identifier">fact_var</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- facts-source -->
          
        </div>

        

        
      </div><!-- facts-method -->

    
      <div id="method-i-filter_output" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filter_output</span><span
            class="method-args">(type, data)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="filter_output-doc">
            
            
            
          </div><!-- filter_output-doc -->

          
          <div class="method-source-code" id="filter_output-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1391</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">filter_output</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">data</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:output</span>
    <span class="ruby-comment"># Hide redundant Facter output</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^Already evaluated [a-z]+ at [^,]+, reevaluating anyways$/</span>
      <span class="ruby-identifier">data</span> = <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:error</span>
    <span class="ruby-comment"># Hide Rubinius SAFE warning</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;WARNING: $SAFE is not supported on Rubinius.&#39;</span>
      <span class="ruby-identifier">data</span> = <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- filter_output-source -->
          
        </div>

        

        
      </div><!-- filter_output-method -->

    
      <div id="method-i-hiera_override_dir" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">hiera_override_dir</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="hiera_override_dir-doc">
            
            
            
          </div><!-- hiera_override_dir-doc -->

          
          <div class="method-source-code" id="hiera_override_dir-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 476</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">hiera_override_dir</span>
  <span class="ruby-identifier">network</span>.<span class="ruby-identifier">hiera_override_dir</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- hiera_override_dir-source -->
          
        </div>

        

        
      </div><!-- hiera_override_dir-method -->

    
      <div id="method-i-hiera_var" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">hiera_var</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="hiera_var-doc">
            
            
            
          </div><!-- hiera_var-doc -->

          
          <div class="method-source-code" id="hiera_var-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 466</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">hiera_var</span>
  <span class="ruby-ivar">@hiera</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- hiera_var-source -->
          
        </div>

        

        
      </div><!-- hiera_var-method -->

    
      <div id="method-i-hiera_var-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">hiera_var=</span><span
            class="method-args">(hiera)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="hiera_var-3D-doc">
            
            
            
          </div><!-- hiera_var-3D-doc -->

          
          <div class="method-source-code" id="hiera_var-3D-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 470</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">hiera_var=</span><span class="ruby-identifier">hiera</span>
  <span class="ruby-ivar">@hiera</span> = <span class="ruby-identifier">hiera</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- hiera_var-3D-source -->
          
        </div>

        

        
      </div><!-- hiera_var-3D-method -->

    
      <div id="method-i-home" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">home</span><span
            class="method-args">(env_var = 'HOME', reset = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="home-doc">
            
            
            
          </div><!-- home-doc -->

          
          <div class="method-source-code" id="home-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 189</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">home</span>(<span class="ruby-identifier">env_var</span> = <span class="ruby-string">&#39;HOME&#39;</span>, <span class="ruby-identifier">reset</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">reset</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">myself</span>[<span class="ruby-value">:user_home</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">myself</span>[<span class="ruby-value">:user_home</span>] = <span class="ruby-identifier">cli_capture</span>(<span class="ruby-value">:echo</span>, <span class="ruby-string">&#39;$&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">env_var</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;$&#39;</span>, <span class="ruby-string">&#39;&#39;</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:user_home</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- home-source -->
          
        </div>

        

        
      </div><!-- home-method -->

    
      <div id="method-i-hostname" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">hostname</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="hostname-doc">
            
            
            
          </div><!-- hostname-doc -->

          
          <div class="method-source-code" id="hostname-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 144</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">hostname</span>
  <span class="ruby-identifier">hostname</span> = <span class="ruby-identifier">setting</span>(<span class="ruby-value">:hostname</span>)

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">hostname</span>
    <span class="ruby-identifier">hostname</span> = <span class="ruby-identifier">plugin_name</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">hostname</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">ui</span>.<span class="ruby-identifier">resource</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">ui</span>.<span class="ruby-identifier">resource</span> = <span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Console</span>.<span class="ruby-identifier">colorize</span>(<span class="ruby-identifier">hostname</span>, <span class="ruby-ivar">@class_color</span>)
    <span class="ruby-identifier">logger</span>      = <span class="ruby-identifier">hostname</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">hostname</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- hostname-source -->
          
        </div>

        

        
      </div><!-- hostname-method -->

    
      <div id="method-i-id" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">id</span><span
            class="method-args">(reset = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="id-doc">
            
            
            
          </div><!-- id-doc -->

          
          <div class="method-source-code" id="id-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 125</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">id</span>(<span class="ruby-identifier">reset</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:id</span>] = <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">plugin_name</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span> <span class="ruby-operator">&amp;&amp;</span> ( <span class="ruby-identifier">reset</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">setting</span>(<span class="ruby-value">:id</span>).<span class="ruby-identifier">nil?</span> )
  <span class="ruby-identifier">setting</span>(<span class="ruby-value">:id</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- id-source -->
          
        </div>

        

        
      </div><!-- id-method -->

    
      <div id="method-i-image" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">image</span><span
            class="method-args">(reset = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="image-doc">
            
            
            
          </div><!-- image-doc -->

          
          <div class="method-source-code" id="image-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 293</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">image</span>(<span class="ruby-identifier">reset</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:image</span>] = <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">image</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span> <span class="ruby-operator">&amp;&amp;</span> ( <span class="ruby-identifier">reset</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">myself</span>[<span class="ruby-value">:image</span>].<span class="ruby-identifier">nil?</span> )
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:image</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- image-source -->
          
        </div>

        

        
      </div><!-- image-method -->

    
      <div id="method-i-image-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">image=</span><span
            class="method-args">(image)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="image-3D-doc">
            
            
            
          </div><!-- image-3D-doc -->

          
          <div class="method-source-code" id="image-3D-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 289</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">image=</span><span class="ruby-identifier">image</span>
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:image</span>] = <span class="ruby-identifier">image</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- image-3D-source -->
          
        </div>

        

        
      </div><!-- image-3D-method -->

    
      <div id="method-i-image_id" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">image_id</span><span
            class="method-args">(image)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="image_id-doc">
            
            
            
          </div><!-- image_id-doc -->

          
          <div class="method-source-code" id="image_id-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1422</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">image_id</span>(<span class="ruby-identifier">image</span>)
  <span class="ruby-identifier">image</span>.<span class="ruby-identifier">id</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- image_id-source -->
          
        </div>

        

        
      </div><!-- image_id-method -->

    
      <div id="method-i-image_search_text" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">image_search_text</span><span
            class="method-args">(image)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="image_search_text-doc">
            
            
            
          </div><!-- image_search_text-doc -->

          
          <div class="method-source-code" id="image_search_text-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1434</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">image_search_text</span>(<span class="ruby-identifier">image</span>)
  <span class="ruby-identifier">image</span>.<span class="ruby-identifier">to_s</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- image_search_text-source -->
          
        </div>

        

        
      </div><!-- image_search_text-method -->

    
      <div id="method-i-images" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">images</span><span
            class="method-args">(search_terms = [], options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="images-doc">
            
            
            
          </div><!-- images-doc -->

          
          <div class="method-source-code" id="images-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 250</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">images</span>(<span class="ruby-identifier">search_terms</span> = [], <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">images</span> = []

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span>
    <span class="ruby-identifier">loaded_images</span> = <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">images</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">loaded_images</span>
      <span class="ruby-identifier">require_all</span> = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:require_all</span>, <span class="ruby-keyword">false</span>)

      <span class="ruby-identifier">loaded_images</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">image</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">usable_image?</span>(<span class="ruby-identifier">image</span>)
          <span class="ruby-identifier">include_image</span> = ( <span class="ruby-identifier">search_terms</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">require_all</span> )
          <span class="ruby-identifier">image_text</span>    = <span class="ruby-identifier">image_search_text</span>(<span class="ruby-identifier">image</span>)

          <span class="ruby-identifier">search_terms</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">term</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:match_case</span>, <span class="ruby-keyword">false</span>)
              <span class="ruby-identifier">success</span> = <span class="ruby-identifier">image_text</span>.<span class="ruby-identifier">match</span>(<span class="ruby-node">/#{term}/</span>)
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">success</span> = <span class="ruby-identifier">image_text</span>.<span class="ruby-identifier">match</span>(<span class="ruby-node">/#{term}/</span>)
            <span class="ruby-keyword">end</span>

            <span class="ruby-keyword">if</span> <span class="ruby-identifier">require_all</span>
              <span class="ruby-identifier">include_image</span> = <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">success</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">include_image</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>

          <span class="ruby-identifier">images</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">image</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">include_image</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">images</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- images-source -->
          
        </div>

        

        
      </div><!-- images-method -->

    
      <div id="method-i-keypair" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">keypair</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="keypair-doc">
            
            
            
          </div><!-- keypair-doc -->

          
          <div class="method-source-code" id="keypair-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">keypair</span>
  <span class="ruby-ivar">@keypair</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- keypair-source -->
          
        </div>

        

        
      </div><!-- keypair-method -->

    
      <div id="method-i-keypair-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">keypair=</span><span
            class="method-args">(keypair)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="keypair-3D-doc">
            
            
            
          </div><!-- keypair-3D-doc -->

          
          <div class="method-source-code" id="keypair-3D-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 99</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">keypair=</span><span class="ruby-identifier">keypair</span>
  <span class="ruby-ivar">@keypair</span> = <span class="ruby-identifier">keypair</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- keypair-3D-source -->
          
        </div>

        

        
      </div><!-- keypair-3D-method -->

    
      <div id="method-i-local-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">local?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="local-3F-doc">
            
            
            
          </div><!-- local-3F-doc -->

          
          <div class="method-source-code" id="local-3F-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 78</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">local?</span>
  <span class="ruby-ivar">@local_context</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- local-3F-source -->
          
        </div>

        

        
      </div><!-- local-3F-method -->

    
      <div id="method-i-local_machine" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">local_machine</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="local_machine-doc">
            
            
            
          </div><!-- local_machine-doc -->

          
          <div class="method-source-code" id="local_machine-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 115</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">local_machine</span>
  <span class="ruby-ivar">@local_machine</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- local_machine-source -->
          
        </div>

        

        
      </div><!-- local_machine-method -->

    
      <div id="method-i-local_machine-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">local_machine=</span><span
            class="method-args">(local_machine)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="local_machine-3D-doc">
            
            
            
          </div><!-- local_machine-3D-doc -->

          
          <div class="method-source-code" id="local_machine-3D-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 119</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">local_machine=</span><span class="ruby-identifier">local_machine</span>
  <span class="ruby-ivar">@local_machine</span> = <span class="ruby-identifier">local_machine</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- local_machine-3D-source -->
          
        </div>

        

        
      </div><!-- local_machine-3D-method -->

    
      <div id="method-i-localize" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">localize</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="localize-doc">
            
            
            
          </div><!-- localize-doc -->

          
          <div class="method-source-code" id="localize-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 56</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">localize</span>
  <span class="ruby-ivar">@local_context</span>       = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">local_machine</span> = <span class="ruby-identifier">create_machine</span>(<span class="ruby-value">:local_machine</span>, <span class="ruby-value">:physical</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- localize-source -->
          
        </div>

        

        
      </div><!-- localize-method -->

    
      <div id="method-i-lookup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">lookup</span><span
            class="method-args">(property, default = nil, options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="lookup-doc">
            
            
            
          </div><!-- lookup-doc -->

          
          <div class="method-source-code" id="lookup-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 482</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">lookup</span>(<span class="ruby-identifier">property</span>, <span class="ruby-identifier">default</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">local?</span>
    <span class="ruby-identifier">config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>).<span class="ruby-identifier">import</span>({ <span class="ruby-value">:property</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">property</span>, <span class="ruby-value">:quiet</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> })
    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">run</span>.<span class="ruby-identifier">node_lookup</span>(<span class="ruby-identifier">config</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>
      <span class="ruby-keyword">return</span> <span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>.<span class="ruby-identifier">value</span>(<span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>.<span class="ruby-identifier">parse_json</span>(<span class="ruby-identifier">result</span>.<span class="ruby-identifier">errors</span>), <span class="ruby-identifier">default</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">default</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">options</span>[<span class="ruby-value">:hiera_scope</span>] = <span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>.<span class="ruby-identifier">prefix</span>(<span class="ruby-string">&#39;::&#39;</span>, <span class="ruby-identifier">facts</span>, <span class="ruby-string">&#39;&#39;</span>)
  <span class="ruby-identifier">lookup_base</span>(<span class="ruby-identifier">property</span>, <span class="ruby-identifier">default</span>, <span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- lookup-source -->
          
        </div>

        

        
      </div><!-- lookup-method -->

    
      <div id="method-i-machine" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">machine</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="machine-doc">
            
            
            
          </div><!-- machine-doc -->

          
          <div class="method-source-code" id="machine-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 105</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">machine</span>
  <span class="ruby-ivar">@machine</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- machine-source -->
          
        </div>

        

        
      </div><!-- machine-method -->

    
      <div id="method-i-machine-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">machine=</span><span
            class="method-args">(machine)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="machine-3D-doc">
            
            
            
          </div><!-- machine-3D-doc -->

          
          <div class="method-source-code" id="machine-3D-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 109</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">machine=</span><span class="ruby-identifier">machine</span>
  <span class="ruby-ivar">@machine</span> = <span class="ruby-identifier">machine</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- machine-3D-source -->
          
        </div>

        

        
      </div><!-- machine-3D-method -->

    
      <div id="method-i-machine_config" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">machine_config</span><span
            class="method-args">() { |config| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="machine_config-doc">
            
            
            
          </div><!-- machine_config-doc -->

          
          <div class="method-source-code" id="machine_config-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 398</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">machine_config</span>
  <span class="ruby-identifier">name</span>   = <span class="ruby-identifier">setting</span>(<span class="ruby-value">:id</span>)
  <span class="ruby-identifier">name</span>   = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">new</span>({ <span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">name</span> }, {}, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>)

  <span class="ruby-keyword">yield</span>(<span class="ruby-identifier">config</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-identifier">config</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- machine_config-source -->
          
        </div>

        

        
      </div><!-- machine_config-method -->

    
      <div id="method-i-machine_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">machine_type</span><span
            class="method-args">(reset = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="machine_type-doc">
            
            
            
          </div><!-- machine_type-doc -->

          
          <div class="method-source-code" id="machine_type-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 232</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">machine_type</span>(<span class="ruby-identifier">reset</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:machine_type</span>] = <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">machine_type</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span> <span class="ruby-operator">&amp;&amp;</span> ( <span class="ruby-identifier">reset</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">myself</span>[<span class="ruby-value">:machine_type</span>].<span class="ruby-identifier">nil?</span> )
  <span class="ruby-identifier">machine_type</span>          = <span class="ruby-identifier">myself</span>[<span class="ruby-value">:machine_type</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine_type</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">machine</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">types</span> = <span class="ruby-identifier">machine_types</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">types</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-identifier">machine_type</span>          = <span class="ruby-identifier">machine_type_id</span>(<span class="ruby-identifier">types</span>.<span class="ruby-identifier">first</span>)
        <span class="ruby-identifier">myself</span>[<span class="ruby-value">:machine_type</span>] = <span class="ruby-identifier">machine_type</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">machine_type</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- machine_type-source -->
          
        </div>

        

        
      </div><!-- machine_type-method -->

    
      <div id="method-i-machine_type_id" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">machine_type_id</span><span
            class="method-args">(machine_type)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="machine_type_id-doc">
            
            
            
          </div><!-- machine_type_id-doc -->

          
          <div class="method-source-code" id="machine_type_id-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1409</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">machine_type_id</span>(<span class="ruby-identifier">machine_type</span>)
  <span class="ruby-identifier">machine_type</span>.<span class="ruby-identifier">id</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- machine_type_id-source -->
          
        </div>

        

        
      </div><!-- machine_type_id-method -->

    
      <div id="method-i-machine_types" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">machine_types</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="machine_types-doc">
            
            
            
          </div><!-- machine_types-doc -->

          
          <div class="method-source-code" id="machine_types-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 228</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">machine_types</span> <span class="ruby-comment"># Must be set at machine level (queried)</span>
  <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">machine_types</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- machine_types-source -->
          
        </div>

        

        
      </div><!-- machine_types-method -->

    
      <div id="method-i-method_missing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">method_missing</span><span
            class="method-args">(method, *args, &code)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="method_missing-doc">
            
            
            
          </div><!-- method_missing-doc -->

          
          <div class="method-source-code" id="method_missing-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 48</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">method_missing</span>(<span class="ruby-identifier">method</span>, *<span class="ruby-identifier">args</span>, &amp;<span class="ruby-identifier">code</span>)
  <span class="ruby-identifier">action</span>(<span class="ruby-identifier">method</span>, *<span class="ruby-identifier">args</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">op</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">code</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">op</span>, <span class="ruby-identifier">data</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">code</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- method_missing-source -->
          
        </div>

        

        
      </div><!-- method_missing-method -->

    
      <div id="method-i-normalize" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">normalize</span><span
            class="method-args">(reload)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="normalize-doc">
            
            
            
          </div><!-- normalize-doc -->

          
          <div class="method-source-code" id="normalize-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 12</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">normalize</span>(<span class="ruby-identifier">reload</span>)
  <span class="ruby-keyword">super</span>

  <span class="ruby-ivar">@class_color</span> = <span class="ruby-value">:purple</span>

  <span class="ruby-identifier">export</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">myself</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">value</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">ui</span>.<span class="ruby-identifier">resource</span> = <span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Console</span>.<span class="ruby-identifier">colorize</span>(<span class="ruby-identifier">hostname</span>, <span class="ruby-ivar">@class_color</span>)
  <span class="ruby-identifier">logger</span>      = <span class="ruby-identifier">hostname</span>

  <span class="ruby-identifier">add_groups</span>([ <span class="ruby-string">&quot;all&quot;</span>, <span class="ruby-identifier">plugin_provider</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">plugin_name</span>.<span class="ruby-identifier">to_s</span> ])

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">reload</span>
    <span class="ruby-ivar">@cli_interface</span> = <span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Liquid</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">method</span>, <span class="ruby-identifier">args</span>, &amp;<span class="ruby-identifier">code</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">result</span> = <span class="ruby-identifier">exec</span>({ <span class="ruby-value">:commands</span> =<span class="ruby-operator">&gt;</span> [ [ <span class="ruby-identifier">method</span>, <span class="ruby-identifier">args</span> ].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>) ] }) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">op</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">code</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">op</span>, <span class="ruby-identifier">data</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">code</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>
        <span class="ruby-identifier">result</span> = <span class="ruby-identifier">result</span>.<span class="ruby-identifier">first</span>
        <span class="ruby-identifier">warn</span>(<span class="ruby-identifier">result</span>.<span class="ruby-identifier">errors</span>, { <span class="ruby-value">:i18n</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> }) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">result</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@action_interface</span> = <span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Liquid</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">method</span>, <span class="ruby-identifier">args</span>, &amp;<span class="ruby-identifier">code</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">action</span>(<span class="ruby-identifier">method</span>, *<span class="ruby-identifier">args</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">op</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">code</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">op</span>, <span class="ruby-identifier">data</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">code</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- normalize-source -->
          
        </div>

        

        
      </div><!-- normalize-method -->

    
      <div id="method-i-private_ip" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">private_ip</span><span
            class="method-args">(reset = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="private_ip-doc">
            
            
            
          </div><!-- private_ip-doc -->

          
          <div class="method-source-code" id="private_ip-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 137</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">private_ip</span>(<span class="ruby-identifier">reset</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:private_ip</span>] = <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">private_ip</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span> <span class="ruby-operator">&amp;&amp;</span> ( <span class="ruby-identifier">reset</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">setting</span>(<span class="ruby-value">:private_ip</span>).<span class="ruby-identifier">nil?</span> )
  <span class="ruby-identifier">setting</span>(<span class="ruby-value">:private_ip</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- private_ip-source -->
          
        </div>

        

        
      </div><!-- private_ip-method -->

    
      <div id="method-i-private_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">private_key</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="private_key-doc">
            
            
            
          </div><!-- private_key-doc -->

          
          <div class="method-source-code" id="private_key-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 209</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">private_key</span>
  <span class="ruby-identifier">config_key</span> = <span class="ruby-identifier">myself</span>[<span class="ruby-value">:private_key</span>]
  <span class="ruby-keyword">return</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">config_key</span>, <span class="ruby-identifier">network</span>.<span class="ruby-identifier">directory</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">config_key</span>
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- private_key-source -->
          
        </div>

        

        
      </div><!-- private_key-method -->

    
      <div id="method-i-private_key-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">private_key=</span><span
            class="method-args">(private_key)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="private_key-3D-doc">
            
            
            
          </div><!-- private_key-3D-doc -->

          
          <div class="method-source-code" id="private_key-3D-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 205</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">private_key=</span><span class="ruby-identifier">private_key</span>
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:private_key</span>] = <span class="ruby-identifier">private_key</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- private_key-3D-source -->
          
        </div>

        

        
      </div><!-- private_key-3D-method -->

    
      <div id="method-i-profiles" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">profiles</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="profiles-doc">
            
            
            
          </div><!-- profiles-doc -->

          
          <div class="method-source-code" id="profiles-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 326</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">profiles</span>
  [ <span class="ruby-identifier">array</span>(<span class="ruby-identifier">myself</span>[<span class="ruby-value">:profiles</span>]), <span class="ruby-identifier">lookup_array</span>(<span class="ruby-value">:profiles</span>).<span class="ruby-identifier">reverse</span> ].<span class="ruby-identifier">flatten</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- profiles-source -->
          
        </div>

        

        
      </div><!-- profiles-method -->

    
      <div id="method-i-profiles-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">profiles=</span><span
            class="method-args">(profiles)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="profiles-3D-doc">
            
            
            
          </div><!-- profiles-3D-doc -->

          
          <div class="method-source-code" id="profiles-3D-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 322</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">profiles=</span><span class="ruby-identifier">profiles</span>
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:profiles</span>] = <span class="ruby-identifier">array</span>(<span class="ruby-identifier">profiles</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- profiles-3D-source -->
          
        </div>

        

        
      </div><!-- profiles-3D-method -->

    
      <div id="method-i-provisioner_info" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provisioner_info</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="provisioner_info-doc">
            
            
            
          </div><!-- provisioner_info-doc -->

          
          <div class="method-source-code" id="provisioner_info-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 332</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provisioner_info</span>
  <span class="ruby-identifier">provisioner_info</span> = {}

  <span class="ruby-comment"># Compose needed provisioners and profiles</span>
  <span class="ruby-identifier">profiles</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">profile</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">info</span> = <span class="ruby-constant">Plugin</span><span class="ruby-operator">::</span><span class="ruby-constant">Provisioner</span>.<span class="ruby-identifier">translate_reference</span>(<span class="ruby-identifier">profile</span>)
      <span class="ruby-identifier">provider</span> = <span class="ruby-identifier">info</span>[<span class="ruby-value">:provider</span>]

      <span class="ruby-identifier">provisioner_info</span>[<span class="ruby-identifier">provider</span>] = { <span class="ruby-value">:profiles</span> =<span class="ruby-operator">&gt;</span> [] } <span class="ruby-keyword">unless</span> <span class="ruby-identifier">provisioner_info</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">provider</span>)
      <span class="ruby-identifier">provisioner_info</span>[<span class="ruby-identifier">provider</span>][<span class="ruby-value">:profiles</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">info</span>[<span class="ruby-value">:profiles</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">provisioner_info</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provisioner_info-source -->
          
        </div>

        

        
      </div><!-- provisioner_info-method -->

    
      <div id="method-i-provisioners" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provisioners</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="provisioners-doc">
            
            
            
          </div><!-- provisioners-doc -->

          
          <div class="method-source-code" id="provisioners-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 349</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provisioners</span>
  <span class="ruby-identifier">provisioners</span> = {}
  <span class="ruby-identifier">provisioner_info</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">provider</span>, <span class="ruby-identifier">node_profiles</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">provisioners</span>[<span class="ruby-identifier">provider</span>] = <span class="ruby-identifier">network</span>.<span class="ruby-identifier">provisioners</span>(<span class="ruby-identifier">provider</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">provisioners</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provisioners-source -->
          
        </div>

        

        
      </div><!-- provisioners-method -->

    
      <div id="method-i-public_ip" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">public_ip</span><span
            class="method-args">(reset = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="public_ip-doc">
            
            
            
          </div><!-- public_ip-doc -->

          
          <div class="method-source-code" id="public_ip-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 132</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">public_ip</span>(<span class="ruby-identifier">reset</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:public_ip</span>] = <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">public_ip</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span> <span class="ruby-operator">&amp;&amp;</span> ( <span class="ruby-identifier">reset</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">setting</span>(<span class="ruby-value">:public_ip</span>).<span class="ruby-identifier">nil?</span> )
  <span class="ruby-identifier">setting</span>(<span class="ruby-value">:public_ip</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- public_ip-source -->
          
        </div>

        

        
      </div><!-- public_ip-method -->

    
      <div id="method-i-public_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">public_key</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="public_key-doc">
            
            
            
          </div><!-- public_key-doc -->

          
          <div class="method-source-code" id="public_key-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 221</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">public_key</span>
  <span class="ruby-identifier">config_key</span> = <span class="ruby-identifier">myself</span>[<span class="ruby-value">:public_key</span>]
  <span class="ruby-keyword">return</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">config_key</span>, <span class="ruby-identifier">network</span>.<span class="ruby-identifier">directory</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">config_key</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- public_key-source -->
          
        </div>

        

        
      </div><!-- public_key-method -->

    
      <div id="method-i-public_key-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">public_key=</span><span
            class="method-args">(public_key)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="public_key-3D-doc">
            
            
            
          </div><!-- public_key-3D-doc -->

          
          <div class="method-source-code" id="public_key-3D-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 217</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">public_key=</span><span class="ruby-identifier">public_key</span>
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:public_key</span>] = <span class="ruby-identifier">public_key</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- public_key-3D-source -->
          
        </div>

        

        
      </div><!-- public_key-3D-method -->

    
      <div id="method-i-reload" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reload</span><span
            class="method-args">(options = {}) { |:config, config| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="reload-doc">
            
            
            
          </div><!-- reload-doc -->

          
          <div class="method-source-code" id="reload-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1163</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reload</span>(<span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">success</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">created?</span>
    <span class="ruby-identifier">config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">extension_check</span>(<span class="ruby-value">:reload</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> })
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Reloading node: #{plugin_name}&quot;</span>)

      <span class="ruby-keyword">yield</span>(<span class="ruby-value">:config</span>, <span class="ruby-identifier">config</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
      <span class="ruby-identifier">success</span> = <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">reload</span>(<span class="ruby-identifier">config</span>.<span class="ruby-identifier">export</span>)

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">block_given?</span>
        <span class="ruby-identifier">process_success</span> = <span class="ruby-keyword">yield</span>(<span class="ruby-value">:process</span>, <span class="ruby-identifier">config</span>)
        <span class="ruby-identifier">success</span>         = <span class="ruby-identifier">process_success</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">process_success</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>
        <span class="ruby-identifier">extension</span>(<span class="ruby-value">:reload_success</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> })
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Node #{plugin_name} does not have an attached machine or is not created so cannot be reloaded&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- reload-source -->
          
        </div>

        

        
      </div><!-- reload-method -->

    
      <div id="method-i-remote_cache_setting" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remote_cache_setting</span><span
            class="method-args">(keys, default = nil, format = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="remote_cache_setting-doc">
            
            
            
          </div><!-- remote_cache_setting-doc -->

          
          <div class="method-source-code" id="remote_cache_setting-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 498</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remote_cache_setting</span>(<span class="ruby-identifier">keys</span>, <span class="ruby-identifier">default</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">format</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">cache_id</span> = <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;.&#39;</span>)
  <span class="ruby-identifier">result</span>   = <span class="ruby-identifier">run</span>.<span class="ruby-identifier">node_cache</span>({ <span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cache_id</span> })

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>
    <span class="ruby-identifier">value</span> = <span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>.<span class="ruby-identifier">value</span>(<span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>.<span class="ruby-identifier">parse_json</span>(<span class="ruby-identifier">result</span>.<span class="ruby-identifier">errors</span>), <span class="ruby-identifier">default</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">value</span> = <span class="ruby-identifier">default</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">filter</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">format</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- remote_cache_setting-source -->
          
        </div>

        

        
      </div><!-- remote_cache_setting-method -->

    
      <div id="method-i-remove_agent" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove_agent</span><span
            class="method-args">(provider)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="remove_agent-doc">
            
            
            
          </div><!-- remove_agent-doc -->

          
          <div class="method-source-code" id="remove_agent-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 391</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_agent</span>(<span class="ruby-identifier">provider</span>)
  <span class="ruby-identifier">delete_setting</span>([ <span class="ruby-value">:agents</span>, <span class="ruby-identifier">provider</span> ])
<span class="ruby-keyword">end</span></pre>
          </div><!-- remove_agent-source -->
          
        </div>

        

        
      </div><!-- remove_agent-method -->

    
      <div id="method-i-remove_custom_facts" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove_custom_facts</span><span
            class="method-args">(*facts)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="remove_custom_facts-doc">
            
            
            
          </div><!-- remove_custom_facts-doc -->

          
          <div class="method-source-code" id="remove_custom_facts-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 314</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_custom_facts</span>(*<span class="ruby-identifier">facts</span>)
  <span class="ruby-identifier">facts</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">delete_setting</span>([ <span class="ruby-value">:facts</span>, <span class="ruby-identifier">name</span> ])
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- remove_custom_facts-source -->
          
        </div>

        

        
      </div><!-- remove_custom_facts-method -->

    
      <div id="method-i-remove_plugin" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove_plugin</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="remove_plugin-doc">
            
            
            
          </div><!-- remove_plugin-doc -->

          
          <div class="method-source-code" id="remove_plugin-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 63</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_plugin</span>
  <span class="ruby-constant">CORL</span>.<span class="ruby-identifier">remove_plugin</span>(<span class="ruby-identifier">local_machine</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">local_machine</span>
  <span class="ruby-constant">CORL</span>.<span class="ruby-identifier">remove_plugin</span>(<span class="ruby-identifier">machine</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- remove_plugin-source -->
          
        </div>

        

        
      </div><!-- remove_plugin-method -->

    
      <div id="method-i-render_image" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">render_image</span><span
            class="method-args">(image)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="render_image-doc">
            
            
            
          </div><!-- render_image-doc -->

          
          <div class="method-source-code" id="render_image-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1428</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">render_image</span>(<span class="ruby-identifier">image</span>)
  <span class="ruby-string">&#39;&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- render_image-source -->
          
        </div>

        

        
      </div><!-- render_image-method -->

    
      <div id="method-i-render_machine_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">render_machine_type</span><span
            class="method-args">(machine_type)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="render_machine_type-doc">
            
            
            
          </div><!-- render_machine_type-doc -->

          
          <div class="method-source-code" id="render_machine_type-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1415</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">render_machine_type</span>(<span class="ruby-identifier">machine_type</span>)
  <span class="ruby-string">&#39;&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- render_machine_type-source -->
          
        </div>

        

        
      </div><!-- render_machine_type-method -->

    
      <div id="method-i-run" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="run-doc">
            
            
            
          </div><!-- run-doc -->

          
          <div class="method-source-code" id="run-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 953</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">run</span>
  <span class="ruby-ivar">@action_interface</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- run-source -->
          
        </div>

        

        
      </div><!-- run-method -->

    
      <div id="method-i-running-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">running?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="running-3F-doc">
            
            
            
          </div><!-- running-3F-doc -->

          
          <div class="method-source-code" id="running-3F-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 71</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">running?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">running?</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span>
  <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- running-3F-source -->
          
        </div>

        

        
      </div><!-- running-3F-method -->

    
      <div id="method-i-save" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save</span><span
            class="method-args">(options = {}) { |config| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="save-doc">
            
            
            
          </div><!-- save-doc -->

          
          <div class="method-source-code" id="save-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1092</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save</span>(<span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>)

  <span class="ruby-comment"># Record machine parameters</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
    <span class="ruby-comment"># Provider or external configuration preparation</span>
    <span class="ruby-keyword">yield</span>(<span class="ruby-identifier">config</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># Default configuration preparation</span>
    <span class="ruby-identifier">id</span>(<span class="ruby-keyword">true</span>)
    <span class="ruby-identifier">public_ip</span>(<span class="ruby-keyword">true</span>)
    <span class="ruby-identifier">private_ip</span>(<span class="ruby-keyword">true</span>)
    <span class="ruby-identifier">state</span>(<span class="ruby-keyword">true</span>)

    <span class="ruby-identifier">machine_type</span>(<span class="ruby-keyword">false</span>)
    <span class="ruby-identifier">image</span>(<span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">remote</span> = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:remote</span>, <span class="ruby-value">:edit</span>)
  <span class="ruby-identifier">remote</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">network</span>.<span class="ruby-identifier">remote</span>(<span class="ruby-identifier">remote</span>)

  <span class="ruby-identifier">network</span>.<span class="ruby-identifier">save</span>(<span class="ruby-identifier">config</span>.<span class="ruby-identifier">import</span>({
    <span class="ruby-value">:commit</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>,
    <span class="ruby-value">:allow_empty</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>,
    <span class="ruby-value">:message</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:message</span>, <span class="ruby-node">&quot;Saving #{plugin_provider} node #{plugin_name}&quot;</span>),
    <span class="ruby-value">:remote</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">remote</span>
  }))
<span class="ruby-keyword">end</span></pre>
          </div><!-- save-source -->
          
        </div>

        

        
      </div><!-- save-method -->

    
      <div id="method-i-send_files" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">send_files</span><span
            class="method-args">(local_path, remote_path, files = nil, permission = '0644', options = {}, &code)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="send_files-doc">
            
            
            
          </div><!-- send_files-doc -->

          
          <div class="method-source-code" id="send_files-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 776</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">send_files</span>(<span class="ruby-identifier">local_path</span>, <span class="ruby-identifier">remote_path</span>, <span class="ruby-identifier">files</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">permission</span> = <span class="ruby-string">&#39;0644&#39;</span>, <span class="ruby-identifier">options</span> = {}, &amp;<span class="ruby-identifier">code</span>)
  <span class="ruby-identifier">local_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">local_path</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">local_path</span>)

  <span class="ruby-identifier">success</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-identifier">send_file</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">local_file</span>, <span class="ruby-identifier">remote_file</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">send_success</span> = <span class="ruby-identifier">upload</span>(<span class="ruby-identifier">local_file</span>, <span class="ruby-identifier">remote_file</span>, <span class="ruby-identifier">options</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">op</span>, <span class="ruby-identifier">upload_options</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">code</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">op</span>, <span class="ruby-identifier">upload_options</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">code</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">send_success</span> = <span class="ruby-identifier">cli_check</span>(<span class="ruby-value">:chmod</span>, <span class="ruby-identifier">permission</span>, <span class="ruby-identifier">remote_file</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">send_success</span>
    <span class="ruby-identifier">send_success</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">files</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
    <span class="ruby-identifier">files</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rel_file_name</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">local_file</span>  = <span class="ruby-node">&quot;#{local_path}/#{rel_file_name}&quot;</span>
      <span class="ruby-identifier">remote_file</span> = <span class="ruby-node">&quot;#{remote_path}/#{rel_file_name}&quot;</span>

      <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">local_file</span>)
        <span class="ruby-identifier">send_success</span> = <span class="ruby-identifier">send_file</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">local_file</span>, <span class="ruby-identifier">remote_file</span>)
        <span class="ruby-identifier">success</span>      = <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">send_success</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">send_success</span> = <span class="ruby-identifier">send_file</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">local_path</span>, <span class="ruby-identifier">remote_path</span>)
    <span class="ruby-identifier">success</span>      = <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">send_success</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- send_files-source -->
          
        </div>

        

        
      </div><!-- send_files-method -->

    
      <div id="method-i-set_remote_cache_setting" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_remote_cache_setting</span><span
            class="method-args">(keys, value)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="set_remote_cache_setting-doc">
            
            
            
          </div><!-- set_remote_cache_setting-doc -->

          
          <div class="method-source-code" id="set_remote_cache_setting-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 512</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_remote_cache_setting</span>(<span class="ruby-identifier">keys</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-identifier">run</span>.<span class="ruby-identifier">node_cache</span>({
    <span class="ruby-value">:name</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;.&#39;</span>),
    <span class="ruby-value">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>.<span class="ruby-identifier">to_json</span>(<span class="ruby-identifier">value</span>, <span class="ruby-keyword">false</span>),
    <span class="ruby-value">:json</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
  }).<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_remote_cache_setting-source -->
          
        </div>

        

        
      </div><!-- set_remote_cache_setting-method -->

    
      <div id="method-i-ssh_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ssh_path</span><span
            class="method-args">(home_env_var = 'HOME', reset = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="ssh_path-doc">
            
            
            
          </div><!-- ssh_path-doc -->

          
          <div class="method-source-code" id="ssh_path-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 198</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ssh_path</span>(<span class="ruby-identifier">home_env_var</span> = <span class="ruby-string">&#39;HOME&#39;</span>, <span class="ruby-identifier">reset</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">home</span> = <span class="ruby-identifier">home</span>(<span class="ruby-identifier">home_env_var</span>, <span class="ruby-identifier">reset</span>)
  <span class="ruby-identifier">home</span> <span class="ruby-operator">?</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">home</span>, <span class="ruby-string">&#39;.ssh&#39;</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- ssh_path-source -->
          
        </div>

        

        
      </div><!-- ssh_path-method -->

    
      <div id="method-i-ssh_port" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ssh_port</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="ssh_port-doc">
            
            
            
          </div><!-- ssh_port-doc -->

          
          <div class="method-source-code" id="ssh_port-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 182</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ssh_port</span>
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:ssh_port</span>] = <span class="ruby-value">22</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">myself</span>[<span class="ruby-value">:ssh_port</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:ssh_port</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- ssh_port-source -->
          
        </div>

        

        
      </div><!-- ssh_port-method -->

    
      <div id="method-i-ssh_port-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ssh_port=</span><span
            class="method-args">(ssh_port)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="ssh_port-3D-doc">
            
            
            
          </div><!-- ssh_port-3D-doc -->

          
          <div class="method-source-code" id="ssh_port-3D-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 177</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ssh_port=</span><span class="ruby-identifier">ssh_port</span>
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:ssh_port</span>] = <span class="ruby-identifier">ssh_port</span>
  <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">init_ssh</span>(<span class="ruby-identifier">ssh_port</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- ssh_port-3D-source -->
          
        </div>

        

        
      </div><!-- ssh_port-3D-method -->

    
      <div id="method-i-start" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">start</span><span
            class="method-args">(options = {}) { |:config, config| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="start-doc">
            
            
            
          </div><!-- start-doc -->

          
          <div class="method-source-code" id="start-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1123</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">start</span>(<span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">success</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span>
    <span class="ruby-identifier">config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">extension_check</span>(<span class="ruby-value">:start</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> })
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Starting node: #{plugin_name}&quot;</span>)

      <span class="ruby-keyword">yield</span>(<span class="ruby-value">:config</span>, <span class="ruby-identifier">config</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
      <span class="ruby-identifier">success</span> = <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">start</span>(<span class="ruby-identifier">config</span>.<span class="ruby-identifier">export</span>)
      <span class="ruby-identifier">success</span> = <span class="ruby-identifier">save</span>(<span class="ruby-identifier">config</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:bootstrap</span>, <span class="ruby-keyword">false</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">bootstrap_script</span>
          <span class="ruby-identifier">result</span> = <span class="ruby-identifier">command</span>(<span class="ruby-node">&quot;HOSTNAME=&#39;#{hostname}&#39; #{bootstrap_script}&quot;</span>, { <span class="ruby-value">:as_admin</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> }) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">op</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">yield</span>(<span class="ruby-node">&quot;bootstrap_#{op}&quot;</span>.<span class="ruby-identifier">to_sym</span>, <span class="ruby-identifier">data</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
            <span class="ruby-identifier">data</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">success</span> = <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">reload</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">block_given?</span>
        <span class="ruby-identifier">process_success</span> = <span class="ruby-keyword">yield</span>(<span class="ruby-value">:process</span>, <span class="ruby-identifier">config</span>)
        <span class="ruby-identifier">success</span>         = <span class="ruby-identifier">process_success</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">process_success</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>
        <span class="ruby-identifier">extension</span>(<span class="ruby-value">:start_success</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> })
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Node #{plugin_name} does not have an attached machine so cannot be started&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- start-source -->
          
        </div>

        

        
      </div><!-- start-method -->

    
      <div id="method-i-state" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">state</span><span
            class="method-args">(reset = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="state-doc">
            
            
            
          </div><!-- state-doc -->

          
          <div class="method-source-code" id="state-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 160</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">state</span>(<span class="ruby-identifier">reset</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:state</span>] = <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">state</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span> <span class="ruby-operator">&amp;&amp;</span> ( <span class="ruby-identifier">reset</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">setting</span>(<span class="ruby-value">:state</span>).<span class="ruby-identifier">nil?</span> )
  <span class="ruby-identifier">setting</span>(<span class="ruby-value">:state</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- state-source -->
          
        </div>

        

        
      </div><!-- state-method -->

    
      <div id="method-i-stop" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">stop</span><span
            class="method-args">(options = {}) { |:config, config| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="stop-doc">
            
            
            
          </div><!-- stop-doc -->

          
          <div class="method-source-code" id="stop-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1222</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">stop</span>(<span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">success</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">running?</span>
    <span class="ruby-identifier">config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">extension_check</span>(<span class="ruby-value">:stop</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> })
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Stopping node: #{plugin_name}&quot;</span>)

      <span class="ruby-keyword">yield</span>(<span class="ruby-value">:config</span>, <span class="ruby-identifier">config</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
      <span class="ruby-identifier">success</span> = <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">stop</span>(<span class="ruby-identifier">config</span>.<span class="ruby-identifier">export</span>)

      <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">machine</span> = <span class="ruby-keyword">nil</span>

      <span class="ruby-identifier">override_settings</span> = <span class="ruby-keyword">false</span>
      <span class="ruby-identifier">override_settings</span> = <span class="ruby-keyword">yield</span>(<span class="ruby-value">:finalize</span>, <span class="ruby-identifier">config</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">block_given?</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">override_settings</span>
        <span class="ruby-identifier">delete_setting</span>(<span class="ruby-value">:id</span>)
        <span class="ruby-identifier">delete_setting</span>(<span class="ruby-value">:public_ip</span>)
        <span class="ruby-identifier">delete_setting</span>(<span class="ruby-value">:private_ip</span>)
        <span class="ruby-identifier">delete_setting</span>(<span class="ruby-value">:ssh_port</span>)
        <span class="ruby-identifier">delete_setting</span>(<span class="ruby-value">:build</span>)

        <span class="ruby-identifier">myself</span>[<span class="ruby-value">:state</span>] = <span class="ruby-value">:stopped</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">success</span> = <span class="ruby-identifier">save</span>(<span class="ruby-identifier">config</span>)

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">block_given?</span>
        <span class="ruby-identifier">process_success</span> = <span class="ruby-keyword">yield</span>(<span class="ruby-value">:process</span>, <span class="ruby-identifier">config</span>)
        <span class="ruby-identifier">success</span>         = <span class="ruby-identifier">process_success</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">process_success</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>
        <span class="ruby-identifier">extension</span>(<span class="ruby-value">:stop_success</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> })
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Node #{plugin_name} does not have an attached machine or is not running so cannot be stopped&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- stop-source -->
          
        </div>

        

        
      </div><!-- stop-method -->

    
      <div id="method-i-terminal" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">terminal</span><span
            class="method-args">(options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="terminal-doc">
            
            
            
          </div><!-- terminal-doc -->

          
          <div class="method-source-code" id="terminal-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 959</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">terminal</span>(<span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">code</span>.<span class="ruby-identifier">unknown_status</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">running?</span>
    <span class="ruby-identifier">config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">extension_check</span>(<span class="ruby-value">:terminal</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> })
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Launching terminal for node: #{plugin_name}&quot;</span>)

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">local?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">local_machine</span>
        <span class="ruby-identifier">active_machine</span> = <span class="ruby-identifier">local_machine</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">active_machine</span> = <span class="ruby-identifier">machine</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">config</span>[<span class="ruby-value">:private_keys</span>] = <span class="ruby-identifier">private_key</span>
      <span class="ruby-identifier">config</span>[<span class="ruby-value">:port</span>]         = <span class="ruby-identifier">ssh_port</span>

      <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">active_machine</span>.<span class="ruby-identifier">terminal</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">config</span>.<span class="ruby-identifier">export</span>)

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>
        <span class="ruby-identifier">extension</span>(<span class="ruby-value">:exec_success</span>, { <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> })
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Node #{plugin_name} does not have an attached machine or is not running so cannot launch terminal&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- terminal-source -->
          
        </div>

        

        
      </div><!-- terminal-method -->

    
      <div id="method-i-translate_reference" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">translate_reference</span><span
            class="method-args">(reference)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="translate_reference-doc">
            
            
            
          </div><!-- translate_reference-doc -->

          
          <div class="method-source-code" id="translate_reference-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 1364</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">translate_reference</span>(<span class="ruby-identifier">reference</span>)
  <span class="ruby-identifier">myself</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">translate_reference</span>(<span class="ruby-identifier">reference</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- translate_reference-source -->
          
        </div>

        

        
      </div><!-- translate_reference-method -->

    
      <div id="method-i-upload" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload</span><span
            class="method-args">(local_path, remote_path, options = {}) { |:config, hook_config| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="upload-doc">
            
            
            
          </div><!-- upload-doc -->

          
          <div class="method-source-code" id="upload-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 737</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload</span>(<span class="ruby-identifier">local_path</span>, <span class="ruby-identifier">remote_path</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">success</span> = <span class="ruby-keyword">false</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">machine</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">machine</span>.<span class="ruby-identifier">running?</span>
    <span class="ruby-identifier">config</span>      = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">ensure</span>(<span class="ruby-identifier">options</span>)
    <span class="ruby-identifier">hook_config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">new</span>({ <span class="ruby-value">:local_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">local_path</span>, <span class="ruby-value">:remote_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">remote_path</span>, <span class="ruby-value">:config</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span> }, {}, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>)
    <span class="ruby-identifier">quiet</span>       = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:quiet</span>, <span class="ruby-keyword">false</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">extension_check</span>(<span class="ruby-value">:upload</span>, <span class="ruby-identifier">hook_config</span>)
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Uploading to #{plugin_name}&quot;</span>)

      <span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Starting upload of #{local_path} to #{remote_path}&quot;</span>, { <span class="ruby-value">:i18n</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> }) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">quiet</span>
      <span class="ruby-keyword">yield</span>(<span class="ruby-value">:config</span>, <span class="ruby-identifier">hook_config</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>

      <span class="ruby-identifier">active_machine</span> = <span class="ruby-identifier">local?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">local_machine</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">machine</span>

      <span class="ruby-identifier">success</span> = <span class="ruby-identifier">active_machine</span>.<span class="ruby-identifier">upload</span>(<span class="ruby-identifier">local_path</span>, <span class="ruby-identifier">remote_path</span>, <span class="ruby-identifier">config</span>.<span class="ruby-identifier">export</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">sent</span>, <span class="ruby-identifier">total</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;#{name}: Sent #{sent} of #{total}&quot;</span>, { <span class="ruby-value">:i18n</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> }) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">quiet</span>
        <span class="ruby-keyword">yield</span>(<span class="ruby-value">:progress</span>, { <span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">name</span>, <span class="ruby-value">:sent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sent</span>, <span class="ruby-value">:total</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">total</span> })
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">block_given?</span>
        <span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Successfully finished upload of #{local_path} to #{remote_path}&quot;</span>, { <span class="ruby-value">:i18n</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> }) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">quiet</span>
        <span class="ruby-identifier">process_success</span> = <span class="ruby-keyword">yield</span>(<span class="ruby-value">:process</span>, <span class="ruby-identifier">hook_config</span>)
        <span class="ruby-identifier">success</span>         = <span class="ruby-identifier">process_success</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">process_success</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span>
        <span class="ruby-identifier">extension</span>(<span class="ruby-value">:upload_success</span>, <span class="ruby-identifier">hook_config</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Node #{plugin_name} does not have an attached machine or is not running so cannot upload&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">success</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- upload-source -->
          
        </div>

        

        
      </div><!-- upload-method -->

    
      <div id="method-i-usable_image-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">usable_image?</span><span
            class="method-args">(image)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="usable_image-3F-doc">
            
            
            
          </div><!-- usable_image-3F-doc -->

          
          <div class="method-source-code" id="usable_image-3F-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 84</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">usable_image?</span>(<span class="ruby-identifier">image</span>)
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- usable_image-3F-source -->
          
        </div>

        

        
      </div><!-- usable_image-3F-method -->

    
      <div id="method-i-user" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">user</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="user-doc">
            
            
            
          </div><!-- user-doc -->

          
          <div class="method-source-code" id="user-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 171</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">user</span>
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:user</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- user-source -->
          
        </div>

        

        
      </div><!-- user-method -->

    
      <div id="method-i-user-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">user=</span><span
            class="method-args">(user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          <div class="method-doc" id="user-3D-doc">
            
            
            
          </div><!-- user-3D-doc -->

          
          <div class="method-source-code" id="user-3D-source">
            <pre><span class="ruby-comment"># File lib/core/plugin/node.rb, line 167</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">user=</span><span class="ruby-identifier">user</span>
  <span class="ruby-identifier">myself</span>[<span class="ruby-value">:user</span>] = <span class="ruby-identifier">user</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- user-3D-source -->
          
        </div>

        

        
      </div><!-- user-3D-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

